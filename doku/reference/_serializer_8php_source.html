<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>zimbraControl: classes/PEAR/XML/Serializer.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>classes/PEAR/XML/Serializer.php</h1>  </div>
</div>
<div class="contents">
<a href="_serializer_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?<a class="code" href="category_p_h_p.html">PHP</a>
<a name="l00002"></a>00002 <span class="comment">/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */</span>
<a name="l00003"></a>00003 
<a name="l00053"></a>00053 require_once <span class="stringliteral">&#39;PEAR.php&#39;</span>;
<a name="l00054"></a>00054 
<a name="l00058"></a>00058 require_once <span class="stringliteral">&#39;XML/Util.php&#39;</span>;
<a name="l00059"></a>00059 
<a name="l00066"></a><a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">00066</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_INDENT&#39;</span>, <span class="stringliteral">&#39;indent&#39;</span>);
<a name="l00067"></a>00067 
<a name="l00074"></a><a class="code" href="_serializer_8php.html#afaef88d878b0f78977901cf0b5600588">00074</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_LINEBREAKS&#39;</span>, <span class="stringliteral">&#39;linebreak&#39;</span>);
<a name="l00075"></a>00075 
<a name="l00083"></a><a class="code" href="_serializer_8php.html#a08a1d58c683814b6c845e3bb6328fd82">00083</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_TYPEHINTS&#39;</span>, <span class="stringliteral">&#39;typeHints&#39;</span>);
<a name="l00084"></a>00084 
<a name="l00092"></a><a class="code" href="_serializer_8php.html#a494042182bfc56022a5510cf9ce5507f">00092</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_XML_DECL_ENABLED&#39;</span>, <span class="stringliteral">&#39;addDecl&#39;</span>);
<a name="l00093"></a>00093 
<a name="l00101"></a><a class="code" href="_serializer_8php.html#a89f1f32653b232d0b5b2ec277aa004e0">00101</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_XML_ENCODING&#39;</span>, <span class="stringliteral">&#39;encoding&#39;</span>);
<a name="l00102"></a>00102 
<a name="l00109"></a><a class="code" href="_serializer_8php.html#a2219421bee07847f1bf695cb7ab4953a">00109</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_DEFAULT_TAG&#39;</span>, <span class="stringliteral">&#39;defaultTagName&#39;</span>);
<a name="l00110"></a>00110 
<a name="l00118"></a><a class="code" href="_serializer_8php.html#adca0a003be64fda910384e27ff2e9647">00118</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_CLASSNAME_AS_TAGNAME&#39;</span>, <span class="stringliteral">&#39;classAsTagName&#39;</span>);
<a name="l00119"></a>00119 
<a name="l00126"></a><a class="code" href="_serializer_8php.html#a707304338328ea87f20ff8b1e35fed94">00126</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_ATTRIBUTE_KEY&#39;</span>, <span class="stringliteral">&#39;keyAttribute&#39;</span>);
<a name="l00127"></a>00127 
<a name="l00134"></a><a class="code" href="_serializer_8php.html#a133333002b170bd4b14dacea5e35106b">00134</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_ATTRIBUTE_TYPE&#39;</span>, <span class="stringliteral">&#39;typeAttribute&#39;</span>);
<a name="l00135"></a>00135 
<a name="l00142"></a><a class="code" href="_serializer_8php.html#a272d3b09d1eb3b824cda8328f8a55a45">00142</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_ATTRIBUTE_CLASS&#39;</span>, <span class="stringliteral">&#39;classAttribute&#39;</span>);
<a name="l00143"></a>00143 
<a name="l00152"></a><a class="code" href="_serializer_8php.html#a9f9df02f2006bc251261e409e87a2113">00152</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_SCALAR_AS_ATTRIBUTES&#39;</span>, <span class="stringliteral">&#39;scalarAsAttributes&#39;</span>);
<a name="l00153"></a>00153 
<a name="l00160"></a><a class="code" href="_serializer_8php.html#aca73f2085c26b83a53b3658d097915b3">00160</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_PREPEND_ATTRIBUTES&#39;</span>, <span class="stringliteral">&#39;prependAttributes&#39;</span>);
<a name="l00161"></a>00161 
<a name="l00171"></a><a class="code" href="_serializer_8php.html#a99841118deeaafb03c916e869259ee2a">00171</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_INDENT_ATTRIBUTES&#39;</span>, <span class="stringliteral">&#39;indentAttributes&#39;</span>);
<a name="l00172"></a>00172 
<a name="l00181"></a><a class="code" href="_serializer_8php.html#a60e94edf1c7b4c915683c7b513431c0a">00181</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_MODE&#39;</span>, <span class="stringliteral">&#39;mode&#39;</span>);
<a name="l00182"></a>00182 
<a name="l00190"></a><a class="code" href="_serializer_8php.html#a488e818cd19eac676fb63fbcf60ef361">00190</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_DOCTYPE_ENABLED&#39;</span>, <span class="stringliteral">&#39;addDoctype&#39;</span>);
<a name="l00191"></a>00191 
<a name="l00200"></a><a class="code" href="_serializer_8php.html#a65694b9a6deebf5212d064df07a5f31b">00200</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_DOCTYPE&#39;</span>, <span class="stringliteral">&#39;doctype&#39;</span>);
<a name="l00201"></a>00201 
<a name="l00209"></a><a class="code" href="_serializer_8php.html#a82a950b8b286909ac658086184e1faeb">00209</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_ROOT_NAME&#39;</span>, <span class="stringliteral">&#39;rootName&#39;</span>);
<a name="l00210"></a>00210 
<a name="l00217"></a><a class="code" href="_serializer_8php.html#a5871261d09c14fce392681040079fa30">00217</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_ROOT_ATTRIBS&#39;</span>, <span class="stringliteral">&#39;rootAttributes&#39;</span>);
<a name="l00218"></a>00218 
<a name="l00225"></a><a class="code" href="_serializer_8php.html#a49251f2f3d7201d79b00d3475729c1c2">00225</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_ATTRIBUTES_KEY&#39;</span>, <span class="stringliteral">&#39;attributesArray&#39;</span>);
<a name="l00226"></a>00226 
<a name="l00236"></a><a class="code" href="_serializer_8php.html#a724a2fd86d1465fbc225263f05116662">00236</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_CONTENT_KEY&#39;</span>, <span class="stringliteral">&#39;contentName&#39;</span>);
<a name="l00237"></a>00237 
<a name="l00245"></a><a class="code" href="_serializer_8php.html#abc8d4638b30bb6c87b72fb92b39812e8">00245</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_COMMENT_KEY&#39;</span>, <span class="stringliteral">&#39;commentName&#39;</span>);
<a name="l00246"></a>00246 
<a name="l00253"></a><a class="code" href="_serializer_8php.html#a1a1c0bb60dea9eeaa5e38f0b0760bfeb">00253</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_TAGMAP&#39;</span>, <span class="stringliteral">&#39;tagMap&#39;</span>);
<a name="l00254"></a>00254 
<a name="l00261"></a><a class="code" href="_serializer_8php.html#a88165b7af2676f6353bb810ae7afc307">00261</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_ENCODE_FUNC&#39;</span>, <span class="stringliteral">&#39;encodeFunction&#39;</span>);
<a name="l00262"></a>00262 
<a name="l00270"></a><a class="code" href="_serializer_8php.html#ad2115407b3bceb1618b68bda565946fa">00270</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_NAMESPACE&#39;</span>, <span class="stringliteral">&#39;namespace&#39;</span>);
<a name="l00271"></a>00271 
<a name="l00281"></a><a class="code" href="_serializer_8php.html#abc1a9ec8eaef8da1316ae2ce22289116">00281</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_ENTITIES&#39;</span>, <span class="stringliteral">&#39;replaceEntities&#39;</span>);
<a name="l00282"></a>00282 
<a name="l00290"></a><a class="code" href="_serializer_8php.html#a9397219c6d9e0f6c1f7170ea6da29e80">00290</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_RETURN_RESULT&#39;</span>, <span class="stringliteral">&#39;returnResult&#39;</span>);
<a name="l00291"></a>00291 
<a name="l00299"></a><a class="code" href="_serializer_8php.html#aba78fedad0ac0d125f3e87dcd32f8637">00299</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_IGNORE_NULL&#39;</span>, <span class="stringliteral">&#39;ignoreNull&#39;</span>);
<a name="l00300"></a>00300 
<a name="l00308"></a><a class="code" href="_serializer_8php.html#acf9cdb6733963030fb9c3966aa1ff302">00308</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_CDATA_SECTIONS&#39;</span>, <span class="stringliteral">&#39;cdata&#39;</span>);
<a name="l00309"></a>00309 
<a name="l00319"></a><a class="code" href="_serializer_8php.html#ac17c094fe95de16efcfd93dd2538b2a6">00319</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_OPTION_FALSE_AS_STRING&#39;</span>, <span class="stringliteral">&#39;falseAsString&#39;</span>);
<a name="l00320"></a>00320 
<a name="l00324"></a><a class="code" href="_serializer_8php.html#ad3c50ac96ce30a482f75d51df2e87e29">00324</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_MODE_DEFAULT&#39;</span>, <span class="stringliteral">&#39;default&#39;</span>);
<a name="l00325"></a>00325 
<a name="l00331"></a><a class="code" href="_serializer_8php.html#afc78afcfbbaf118a2e69c2354485ceb7">00331</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_MODE_SIMPLEXML&#39;</span>, <span class="stringliteral">&#39;simplexml&#39;</span>);
<a name="l00332"></a>00332 
<a name="l00336"></a><a class="code" href="_serializer_8php.html#a086cfb1201cb5ea73e7ff455e6154d54">00336</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_ERROR_NO_SERIALIZATION&#39;</span>, 51);
<a name="l00337"></a>00337 
<a name="l00341"></a><a class="code" href="_serializer_8php.html#aaf3c11f2aa30fb1995225490a281c736">00341</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_ENTITIES_NONE&#39;</span>, <a class="code" href="_util_8php.html#a3e39c4de45747c4a436a197acc75d72b">XML_UTIL_ENTITIES_NONE</a>);
<a name="l00342"></a>00342 
<a name="l00347"></a><a class="code" href="_serializer_8php.html#a05835ecf64bb8b57d76362a889ca26d1">00347</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_ENTITIES_XML&#39;</span>, <a class="code" href="_util_8php.html#aee3faa1314a6abe518b9b99d572c3303">XML_UTIL_ENTITIES_XML</a>);
<a name="l00348"></a>00348 
<a name="l00353"></a><a class="code" href="_serializer_8php.html#a685cee55cd710b6d5de6e08f0369ffcf">00353</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_ENTITIES_XML_REQUIRED&#39;</span>, <a class="code" href="_util_8php.html#af56fcf7480556c113be98ad06f8b44d7">XML_UTIL_ENTITIES_XML_REQUIRED</a>);
<a name="l00354"></a>00354 
<a name="l00359"></a><a class="code" href="_serializer_8php.html#a7acfe4e5e8bdd9a3881d27024b49324a">00359</a> define(<span class="stringliteral">&#39;XML_SERIALIZER_ENTITIES_HTML&#39;</span>, <a class="code" href="_util_8php.html#aff259f98ce0efb02ade5924bdce7b30f">XML_UTIL_ENTITIES_HTML</a>);
<a name="l00360"></a>00360 
<a name="l00428"></a><a class="code" href="class_x_m_l___serializer.html">00428</a> <span class="keyword">class </span><a class="code" href="class_x_m_l___serializer.html">XML_Serializer</a> <span class="keyword">extends</span> <a class="code" href="class_p_e_a_r.html">PEAR</a>
<a name="l00429"></a>00429 {
<a name="l00436"></a><a class="code" href="class_x_m_l___serializer.html#a740a98520da60a6f528c8f8db10e1028">00436</a>     var <a class="code" href="class_x_m_l___serializer.html#a740a98520da60a6f528c8f8db10e1028">$_knownOptions</a> = array(
<a name="l00437"></a>00437         <a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>,
<a name="l00438"></a>00438         <a class="code" href="_serializer_8php.html#afaef88d878b0f78977901cf0b5600588">XML_SERIALIZER_OPTION_LINEBREAKS</a>,
<a name="l00439"></a>00439         <a class="code" href="_serializer_8php.html#a08a1d58c683814b6c845e3bb6328fd82">XML_SERIALIZER_OPTION_TYPEHINTS</a>,
<a name="l00440"></a>00440         <a class="code" href="_serializer_8php.html#a494042182bfc56022a5510cf9ce5507f">XML_SERIALIZER_OPTION_XML_DECL_ENABLED</a>,
<a name="l00441"></a>00441         <a class="code" href="_serializer_8php.html#a89f1f32653b232d0b5b2ec277aa004e0">XML_SERIALIZER_OPTION_XML_ENCODING</a>,
<a name="l00442"></a>00442         <a class="code" href="_serializer_8php.html#a2219421bee07847f1bf695cb7ab4953a">XML_SERIALIZER_OPTION_DEFAULT_TAG</a>,
<a name="l00443"></a>00443         <a class="code" href="_serializer_8php.html#adca0a003be64fda910384e27ff2e9647">XML_SERIALIZER_OPTION_CLASSNAME_AS_TAGNAME</a>,
<a name="l00444"></a>00444         <a class="code" href="_serializer_8php.html#a707304338328ea87f20ff8b1e35fed94">XML_SERIALIZER_OPTION_ATTRIBUTE_KEY</a>,
<a name="l00445"></a>00445         <a class="code" href="_serializer_8php.html#a133333002b170bd4b14dacea5e35106b">XML_SERIALIZER_OPTION_ATTRIBUTE_TYPE</a>,
<a name="l00446"></a>00446         <a class="code" href="_serializer_8php.html#a272d3b09d1eb3b824cda8328f8a55a45">XML_SERIALIZER_OPTION_ATTRIBUTE_CLASS</a>,
<a name="l00447"></a>00447         <a class="code" href="_serializer_8php.html#a9f9df02f2006bc251261e409e87a2113">XML_SERIALIZER_OPTION_SCALAR_AS_ATTRIBUTES</a>,
<a name="l00448"></a>00448         <a class="code" href="_serializer_8php.html#aca73f2085c26b83a53b3658d097915b3">XML_SERIALIZER_OPTION_PREPEND_ATTRIBUTES</a>,
<a name="l00449"></a>00449         <a class="code" href="_serializer_8php.html#a99841118deeaafb03c916e869259ee2a">XML_SERIALIZER_OPTION_INDENT_ATTRIBUTES</a>,
<a name="l00450"></a>00450         <a class="code" href="_serializer_8php.html#a60e94edf1c7b4c915683c7b513431c0a">XML_SERIALIZER_OPTION_MODE</a>,
<a name="l00451"></a>00451         <a class="code" href="_serializer_8php.html#a488e818cd19eac676fb63fbcf60ef361">XML_SERIALIZER_OPTION_DOCTYPE_ENABLED</a>,
<a name="l00452"></a>00452         <a class="code" href="_serializer_8php.html#a65694b9a6deebf5212d064df07a5f31b">XML_SERIALIZER_OPTION_DOCTYPE</a>,
<a name="l00453"></a>00453         <a class="code" href="_serializer_8php.html#a82a950b8b286909ac658086184e1faeb">XML_SERIALIZER_OPTION_ROOT_NAME</a>,
<a name="l00454"></a>00454         <a class="code" href="_serializer_8php.html#a5871261d09c14fce392681040079fa30">XML_SERIALIZER_OPTION_ROOT_ATTRIBS</a>,
<a name="l00455"></a>00455         <a class="code" href="_serializer_8php.html#a49251f2f3d7201d79b00d3475729c1c2">XML_SERIALIZER_OPTION_ATTRIBUTES_KEY</a>,
<a name="l00456"></a>00456         <a class="code" href="_serializer_8php.html#a724a2fd86d1465fbc225263f05116662">XML_SERIALIZER_OPTION_CONTENT_KEY</a>,
<a name="l00457"></a>00457         <a class="code" href="_serializer_8php.html#abc8d4638b30bb6c87b72fb92b39812e8">XML_SERIALIZER_OPTION_COMMENT_KEY</a>,
<a name="l00458"></a>00458         <a class="code" href="_serializer_8php.html#a1a1c0bb60dea9eeaa5e38f0b0760bfeb">XML_SERIALIZER_OPTION_TAGMAP</a>,
<a name="l00459"></a>00459         <a class="code" href="_serializer_8php.html#a88165b7af2676f6353bb810ae7afc307">XML_SERIALIZER_OPTION_ENCODE_FUNC</a>,
<a name="l00460"></a>00460         <a class="code" href="_serializer_8php.html#ad2115407b3bceb1618b68bda565946fa">XML_SERIALIZER_OPTION_NAMESPACE</a>,
<a name="l00461"></a>00461         <a class="code" href="_serializer_8php.html#abc1a9ec8eaef8da1316ae2ce22289116">XML_SERIALIZER_OPTION_ENTITIES</a>,
<a name="l00462"></a>00462         <a class="code" href="_serializer_8php.html#a9397219c6d9e0f6c1f7170ea6da29e80">XML_SERIALIZER_OPTION_RETURN_RESULT</a>,
<a name="l00463"></a>00463         <a class="code" href="_serializer_8php.html#aba78fedad0ac0d125f3e87dcd32f8637">XML_SERIALIZER_OPTION_IGNORE_NULL</a>,
<a name="l00464"></a>00464         <a class="code" href="_serializer_8php.html#acf9cdb6733963030fb9c3966aa1ff302">XML_SERIALIZER_OPTION_CDATA_SECTIONS</a>,
<a name="l00465"></a>00465     );
<a name="l00466"></a>00466 
<a name="l00473"></a><a class="code" href="class_x_m_l___serializer.html#a61f8e37bb59579db7eca5d6bd914441d">00473</a>     var <a class="code" href="class_x_m_l___serializer.html#a61f8e37bb59579db7eca5d6bd914441d">$_defaultOptions</a> = array(
<a name="l00474"></a>00474 
<a name="l00475"></a>00475         <span class="comment">// string used for indentation</span>
<a name="l00476"></a>00476         <a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00477"></a>00477 
<a name="l00478"></a>00478         <span class="comment">// string used for newlines</span>
<a name="l00479"></a>00479         <a class="code" href="_serializer_8php.html#afaef88d878b0f78977901cf0b5600588">XML_SERIALIZER_OPTION_LINEBREAKS</a> =&gt; <span class="stringliteral">&quot;\n&quot;</span>,
<a name="l00480"></a>00480 
<a name="l00481"></a>00481         <span class="comment">// automatically add type hin attributes</span>
<a name="l00482"></a>00482         <a class="code" href="_serializer_8php.html#a08a1d58c683814b6c845e3bb6328fd82">XML_SERIALIZER_OPTION_TYPEHINTS</a> =&gt; <span class="keyword">false</span>,
<a name="l00483"></a>00483 
<a name="l00484"></a>00484         <span class="comment">// add an XML declaration</span>
<a name="l00485"></a>00485         <a class="code" href="_serializer_8php.html#a494042182bfc56022a5510cf9ce5507f">XML_SERIALIZER_OPTION_XML_DECL_ENABLED</a> =&gt; <span class="keyword">false</span>,
<a name="l00486"></a>00486 
<a name="l00487"></a>00487         <span class="comment">// encoding specified in the XML declaration</span>
<a name="l00488"></a>00488         <a class="code" href="_serializer_8php.html#a89f1f32653b232d0b5b2ec277aa004e0">XML_SERIALIZER_OPTION_XML_ENCODING</a> =&gt; null,
<a name="l00489"></a>00489 
<a name="l00490"></a>00490         <span class="comment">// tag used for indexed arrays or invalid names</span>
<a name="l00491"></a>00491         <a class="code" href="_serializer_8php.html#a2219421bee07847f1bf695cb7ab4953a">XML_SERIALIZER_OPTION_DEFAULT_TAG</a> =&gt; <span class="stringliteral">&#39;XML_Serializer_Tag&#39;</span>,
<a name="l00492"></a>00492 
<a name="l00493"></a>00493         <span class="comment">// use classname for objects in indexed arrays</span>
<a name="l00494"></a>00494         <a class="code" href="_serializer_8php.html#adca0a003be64fda910384e27ff2e9647">XML_SERIALIZER_OPTION_CLASSNAME_AS_TAGNAME</a> =&gt; <span class="keyword">false</span>,
<a name="l00495"></a>00495 
<a name="l00496"></a>00496         <span class="comment">// attribute where original key is stored</span>
<a name="l00497"></a>00497         <a class="code" href="_serializer_8php.html#a707304338328ea87f20ff8b1e35fed94">XML_SERIALIZER_OPTION_ATTRIBUTE_KEY</a> =&gt; <span class="stringliteral">&#39;_originalKey&#39;</span>,
<a name="l00498"></a>00498 
<a name="l00499"></a>00499         <span class="comment">// attribute for type (only if typeHints =&gt; true)</span>
<a name="l00500"></a>00500         <a class="code" href="_serializer_8php.html#a133333002b170bd4b14dacea5e35106b">XML_SERIALIZER_OPTION_ATTRIBUTE_TYPE</a> =&gt; <span class="stringliteral">&#39;_type&#39;</span>,
<a name="l00501"></a>00501 
<a name="l00502"></a>00502         <span class="comment">// attribute for class of objects (only if typeHints =&gt; true)</span>
<a name="l00503"></a>00503         <a class="code" href="_serializer_8php.html#a272d3b09d1eb3b824cda8328f8a55a45">XML_SERIALIZER_OPTION_ATTRIBUTE_CLASS</a> =&gt; <span class="stringliteral">&#39;_class&#39;</span>,
<a name="l00504"></a>00504 
<a name="l00505"></a>00505         <span class="comment">// scalar values (strings, ints,..) will be serialized as attribute</span>
<a name="l00506"></a>00506         <a class="code" href="_serializer_8php.html#a9f9df02f2006bc251261e409e87a2113">XML_SERIALIZER_OPTION_SCALAR_AS_ATTRIBUTES</a> =&gt; <span class="keyword">false</span>,
<a name="l00507"></a>00507 
<a name="l00508"></a>00508         <span class="comment">// prepend string for attributes</span>
<a name="l00509"></a>00509         <a class="code" href="_serializer_8php.html#aca73f2085c26b83a53b3658d097915b3">XML_SERIALIZER_OPTION_PREPEND_ATTRIBUTES</a> =&gt; <span class="stringliteral">&#39;&#39;</span>,
<a name="l00510"></a>00510 
<a name="l00511"></a>00511         <span class="comment">// indent the attributes, if set to &#39;_auto&#39;,</span>
<a name="l00512"></a>00512         <span class="comment">// it will indent attributes so they all start at the same column</span>
<a name="l00513"></a>00513         <a class="code" href="_serializer_8php.html#a99841118deeaafb03c916e869259ee2a">XML_SERIALIZER_OPTION_INDENT_ATTRIBUTES</a> =&gt; <span class="keyword">false</span>,
<a name="l00514"></a>00514 
<a name="l00515"></a>00515         <span class="comment">// use XML_SERIALIZER_MODE_SIMPLEXML to use parent name as tagname</span>
<a name="l00516"></a>00516         <span class="comment">// if transforming an indexed array</span>
<a name="l00517"></a>00517         <a class="code" href="_serializer_8php.html#a60e94edf1c7b4c915683c7b513431c0a">XML_SERIALIZER_OPTION_MODE</a> =&gt; <a class="code" href="_serializer_8php.html#ad3c50ac96ce30a482f75d51df2e87e29">XML_SERIALIZER_MODE_DEFAULT</a>,
<a name="l00518"></a>00518 
<a name="l00519"></a>00519         <span class="comment">// add a doctype declaration</span>
<a name="l00520"></a>00520         <a class="code" href="_serializer_8php.html#a488e818cd19eac676fb63fbcf60ef361">XML_SERIALIZER_OPTION_DOCTYPE_ENABLED</a> =&gt; <span class="keyword">false</span>,
<a name="l00521"></a>00521 
<a name="l00522"></a>00522         <span class="comment">// supply a string or an array with id and uri</span>
<a name="l00523"></a>00523         <span class="comment">// ({@see XML_Util::getDoctypeDeclaration()}</span>
<a name="l00524"></a>00524         <a class="code" href="_serializer_8php.html#a65694b9a6deebf5212d064df07a5f31b">XML_SERIALIZER_OPTION_DOCTYPE</a> =&gt; null,
<a name="l00525"></a>00525 
<a name="l00526"></a>00526         <span class="comment">// name of the root tag</span>
<a name="l00527"></a>00527         <a class="code" href="_serializer_8php.html#a82a950b8b286909ac658086184e1faeb">XML_SERIALIZER_OPTION_ROOT_NAME</a> =&gt; null,
<a name="l00528"></a>00528 
<a name="l00529"></a>00529         <span class="comment">// attributes of the root tag</span>
<a name="l00530"></a>00530         <a class="code" href="_serializer_8php.html#a5871261d09c14fce392681040079fa30">XML_SERIALIZER_OPTION_ROOT_ATTRIBS</a> =&gt; array(),
<a name="l00531"></a>00531 
<a name="l00532"></a>00532         <span class="comment">// all values in this key will be treated as attributes</span>
<a name="l00533"></a>00533         <a class="code" href="_serializer_8php.html#a49251f2f3d7201d79b00d3475729c1c2">XML_SERIALIZER_OPTION_ATTRIBUTES_KEY</a> =&gt; null,
<a name="l00534"></a>00534 
<a name="l00535"></a>00535         <span class="comment">// this value will be used directly as content,</span>
<a name="l00536"></a>00536         <span class="comment">// instead of creating a new tag, may only be used</span>
<a name="l00537"></a>00537         <span class="comment">// in conjuction with attributesArray</span>
<a name="l00538"></a>00538         <a class="code" href="_serializer_8php.html#a724a2fd86d1465fbc225263f05116662">XML_SERIALIZER_OPTION_CONTENT_KEY</a> =&gt; null,
<a name="l00539"></a>00539 
<a name="l00540"></a>00540         <span class="comment">// this value will be used directly as comment,</span>
<a name="l00541"></a>00541         <span class="comment">// instead of creating a new tag, may only be used</span>
<a name="l00542"></a>00542         <span class="comment">// in conjuction with attributesArray</span>
<a name="l00543"></a>00543         <a class="code" href="_serializer_8php.html#abc8d4638b30bb6c87b72fb92b39812e8">XML_SERIALIZER_OPTION_COMMENT_KEY</a> =&gt; null,
<a name="l00544"></a>00544 
<a name="l00545"></a>00545         <span class="comment">// tag names that will be changed</span>
<a name="l00546"></a>00546         <a class="code" href="_serializer_8php.html#a1a1c0bb60dea9eeaa5e38f0b0760bfeb">XML_SERIALIZER_OPTION_TAGMAP</a> =&gt; array(),
<a name="l00547"></a>00547 
<a name="l00548"></a>00548         <span class="comment">// function that will be applied before serializing</span>
<a name="l00549"></a>00549         <a class="code" href="_serializer_8php.html#a88165b7af2676f6353bb810ae7afc307">XML_SERIALIZER_OPTION_ENCODE_FUNC</a> =&gt; null,
<a name="l00550"></a>00550 
<a name="l00551"></a>00551         <span class="comment">// namespace to use</span>
<a name="l00552"></a>00552         <a class="code" href="_serializer_8php.html#ad2115407b3bceb1618b68bda565946fa">XML_SERIALIZER_OPTION_NAMESPACE</a> =&gt; null,
<a name="l00553"></a>00553 
<a name="l00554"></a>00554         <span class="comment">// type of entities to replace,</span>
<a name="l00555"></a>00555         <a class="code" href="_serializer_8php.html#abc1a9ec8eaef8da1316ae2ce22289116">XML_SERIALIZER_OPTION_ENTITIES</a> =&gt; <a class="code" href="_serializer_8php.html#a05835ecf64bb8b57d76362a889ca26d1">XML_SERIALIZER_ENTITIES_XML</a>,
<a name="l00556"></a>00556 
<a name="l00557"></a>00557         <span class="comment">// serialize() returns the result of the serialization instead of true</span>
<a name="l00558"></a>00558         <a class="code" href="_serializer_8php.html#a9397219c6d9e0f6c1f7170ea6da29e80">XML_SERIALIZER_OPTION_RETURN_RESULT</a> =&gt; <span class="keyword">false</span>,
<a name="l00559"></a>00559 
<a name="l00560"></a>00560         <span class="comment">// ignore properties that are set to null</span>
<a name="l00561"></a>00561         <a class="code" href="_serializer_8php.html#aba78fedad0ac0d125f3e87dcd32f8637">XML_SERIALIZER_OPTION_IGNORE_NULL</a> =&gt; <span class="keyword">false</span>,
<a name="l00562"></a>00562 
<a name="l00563"></a>00563         <span class="comment">// Whether to use cdata sections for plain character data</span>
<a name="l00564"></a>00564         <a class="code" href="_serializer_8php.html#acf9cdb6733963030fb9c3966aa1ff302">XML_SERIALIZER_OPTION_CDATA_SECTIONS</a> =&gt; <span class="keyword">false</span>,
<a name="l00565"></a>00565 
<a name="l00566"></a>00566         <span class="comment">// Whether to convert a boolean FALSE into a string</span>
<a name="l00567"></a>00567         <a class="code" href="_serializer_8php.html#ac17c094fe95de16efcfd93dd2538b2a6">XML_SERIALIZER_OPTION_FALSE_AS_STRING</a> =&gt; <span class="keyword">false</span>,
<a name="l00568"></a>00568     );
<a name="l00569"></a>00569 
<a name="l00576"></a><a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">00576</a>     var <a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a> = array();
<a name="l00577"></a>00577 
<a name="l00584"></a><a class="code" href="class_x_m_l___serializer.html#a8df728b6c2aa474bd7636da33862385f">00584</a>     var <a class="code" href="class_x_m_l___serializer.html#a8df728b6c2aa474bd7636da33862385f">$_tagDepth</a> = 0;
<a name="l00585"></a>00585 
<a name="l00592"></a><a class="code" href="class_x_m_l___serializer.html#a885ffa5b2358f555f0a55226a0c34ee0">00592</a>     var <a class="code" href="class_x_m_l___serializer.html#a885ffa5b2358f555f0a55226a0c34ee0">$_serializedData</a> = null;
<a name="l00593"></a>00593 
<a name="l00601"></a><a class="code" href="class_x_m_l___serializer.html#a7a50e8b9f3a2f72d56ea75606d72e929">00601</a>     function <a class="code" href="class_x_m_l___serializer.html#a7a50e8b9f3a2f72d56ea75606d72e929">XML_Serializer</a>( <a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a> = null )
<a name="l00602"></a>00602     {
<a name="l00603"></a>00603         $this-&gt;<a class="code" href="class_p_e_a_r.html#ab76d2aef23b43b051f5227add98caf98">PEAR</a>();
<a name="l00604"></a>00604         <span class="keywordflow">if</span> (is_array(<a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {
<a name="l00605"></a>00605             $this-&gt;options = array_merge($this-&gt;_defaultOptions, <a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00606"></a>00606         } <span class="keywordflow">else</span> {
<a name="l00607"></a>00607             $this-&gt;options = $this-&gt;_defaultOptions;
<a name="l00608"></a>00608         }
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610 
<a name="l00618"></a><a class="code" href="class_x_m_l___serializer.html#aa162e09c6645943bd27c88a15c0059fd">00618</a>     function <a class="code" href="class_x_m_l___serializer.html#aa162e09c6645943bd27c88a15c0059fd">apiVersion</a>()
<a name="l00619"></a>00619     {
<a name="l00620"></a>00620         <span class="keywordflow">return</span> <span class="stringliteral">&#39;0.20.0&#39;</span>;
<a name="l00621"></a>00621     }
<a name="l00622"></a>00622 
<a name="l00629"></a><a class="code" href="class_x_m_l___serializer.html#a58693f7b99552413d9296e986bc22bb9">00629</a>     function <a class="code" href="class_x_m_l___serializer.html#a58693f7b99552413d9296e986bc22bb9">resetOptions</a>()
<a name="l00630"></a>00630     {
<a name="l00631"></a>00631         $this-&gt;options = $this-&gt;_defaultOptions;
<a name="l00632"></a>00632     }
<a name="l00633"></a>00633 
<a name="l00646"></a><a class="code" href="class_x_m_l___serializer.html#a7184fec9134a57cae6ef66b3588513d1">00646</a>     function <a class="code" href="class_x_m_l___serializer.html#a7184fec9134a57cae6ef66b3588513d1">setOption</a>($name, $value)
<a name="l00647"></a>00647     {
<a name="l00648"></a>00648         $this-&gt;options[$name] = $value;
<a name="l00649"></a>00649     }
<a name="l00650"></a>00650 
<a name="l00662"></a><a class="code" href="class_x_m_l___serializer.html#a8213e4c39213f7d6250f72ff6f2699f2">00662</a>     function <a class="code" href="class_x_m_l___serializer.html#a8213e4c39213f7d6250f72ff6f2699f2">setOptions</a>(<a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a>)
<a name="l00663"></a>00663     {
<a name="l00664"></a>00664         $this-&gt;options = array_merge($this-&gt;options, <a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00665"></a>00665     }
<a name="l00666"></a>00666 
<a name="l00679"></a><a class="code" href="class_x_m_l___serializer.html#abc22899f4292aa72d28a1a0fa30b3251">00679</a>     function <a class="code" href="class_x_m_l___serializer.html#abc22899f4292aa72d28a1a0fa30b3251">serialize</a>($data, <a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a> = null)
<a name="l00680"></a>00680     {
<a name="l00681"></a>00681         <span class="comment">// if options have been specified, use them instead</span>
<a name="l00682"></a>00682         <span class="comment">// of the previously defined ones</span>
<a name="l00683"></a>00683         <span class="keywordflow">if</span> (is_array(<a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a>)) {
<a name="l00684"></a>00684             $optionsBak = $this-&gt;options;
<a name="l00685"></a>00685             <span class="keywordflow">if</span> (isset(<a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;overrideOptions&#39;</span>])
<a name="l00686"></a>00686                 &amp;&amp; <a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a>[<span class="stringliteral">&#39;overrideOptions&#39;</span>] == <span class="keyword">true</span>
<a name="l00687"></a>00687             ) {
<a name="l00688"></a>00688                 $this-&gt;options = array_merge($this-&gt;_defaultOptions, <a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00689"></a>00689             } <span class="keywordflow">else</span> {
<a name="l00690"></a>00690                 $this-&gt;options = array_merge($this-&gt;options, <a class="code" href="class_x_m_l___serializer.html#a011800c63ece4cbbfa77136a20607023">$options</a>);
<a name="l00691"></a>00691             }
<a name="l00692"></a>00692         } <span class="keywordflow">else</span> {
<a name="l00693"></a>00693             $optionsBak = null;
<a name="l00694"></a>00694         }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696         <span class="comment">//  start depth is zero</span>
<a name="l00697"></a>00697         $this-&gt;_tagDepth = 0;
<a name="l00698"></a>00698 
<a name="l00699"></a>00699         $rootAttributes = $this-&gt;options[XML_SERIALIZER_OPTION_ROOT_ATTRIBS];
<a name="l00700"></a>00700         <span class="keywordflow">if</span> (isset($this-&gt;options[<a class="code" href="_serializer_8php.html#ad2115407b3bceb1618b68bda565946fa">XML_SERIALIZER_OPTION_NAMESPACE</a>])
<a name="l00701"></a>00701             &amp;&amp; is_array($this-&gt;options[XML_SERIALIZER_OPTION_NAMESPACE])
<a name="l00702"></a>00702         ) {
<a name="l00703"></a>00703             $rootAttributes[<span class="stringliteral">&#39;xmlns:&#39;</span>
<a name="l00704"></a>00704                 . $this-&gt;options[XML_SERIALIZER_OPTION_NAMESPACE][0]] =
<a name="l00705"></a>00705                 $this-&gt;options[XML_SERIALIZER_OPTION_NAMESPACE][1];
<a name="l00706"></a>00706         }
<a name="l00707"></a>00707 
<a name="l00708"></a>00708         $this-&gt;_serializedData = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00709"></a>00709         <span class="comment">// serialize an array</span>
<a name="l00710"></a>00710         <span class="keywordflow">if</span> (is_array($data)) {
<a name="l00711"></a>00711             <span class="keywordflow">if</span> (isset($this-&gt;options[<a class="code" href="_serializer_8php.html#a82a950b8b286909ac658086184e1faeb">XML_SERIALIZER_OPTION_ROOT_NAME</a>])) {
<a name="l00712"></a>00712                 $tagName = $this-&gt;options[XML_SERIALIZER_OPTION_ROOT_NAME];
<a name="l00713"></a>00713             } <span class="keywordflow">else</span> {
<a name="l00714"></a>00714                 $tagName = <span class="stringliteral">&#39;array&#39;</span>;
<a name="l00715"></a>00715             }
<a name="l00716"></a>00716 
<a name="l00717"></a>00717             $this-&gt;_serializedData .=
<a name="l00718"></a>00718                 $this-&gt;<a class="code" href="class_x_m_l___serializer.html#aef75df6dd1978c4930921a0234b3a0cb">_serializeArray</a>($data, $tagName, $rootAttributes);
<a name="l00719"></a>00719         } elseif (is_object($data)) {
<a name="l00720"></a>00720             <span class="comment">// serialize an object</span>
<a name="l00721"></a>00721             <span class="keywordflow">if</span> (isset($this-&gt;options[<a class="code" href="_serializer_8php.html#a82a950b8b286909ac658086184e1faeb">XML_SERIALIZER_OPTION_ROOT_NAME</a>])) {
<a name="l00722"></a>00722                 $tagName = $this-&gt;options[XML_SERIALIZER_OPTION_ROOT_NAME];
<a name="l00723"></a>00723             } <span class="keywordflow">else</span> {
<a name="l00724"></a>00724                 $tagName = get_class($data);
<a name="l00725"></a>00725             }
<a name="l00726"></a>00726             $this-&gt;_serializedData .=
<a name="l00727"></a>00727                 $this-&gt;<a class="code" href="class_x_m_l___serializer.html#ad18824472f27e7473da357e81dfcfccd">_serializeObject</a>($data, $tagName, $rootAttributes);
<a name="l00728"></a>00728         } <span class="keywordflow">else</span> {
<a name="l00729"></a>00729             $tag = array();
<a name="l00730"></a>00730             <span class="keywordflow">if</span> (isset($this-&gt;options[<a class="code" href="_serializer_8php.html#a82a950b8b286909ac658086184e1faeb">XML_SERIALIZER_OPTION_ROOT_NAME</a>])) {
<a name="l00731"></a>00731                 $tag[<span class="stringliteral">&#39;qname&#39;</span>] = $this-&gt;options[XML_SERIALIZER_OPTION_ROOT_NAME];
<a name="l00732"></a>00732             } <span class="keywordflow">else</span> {
<a name="l00733"></a>00733                 $tag[<span class="stringliteral">&#39;qname&#39;</span>] = gettype($data);
<a name="l00734"></a>00734             }
<a name="l00735"></a>00735             $tagName = $tag[<span class="stringliteral">&#39;qname&#39;</span>];
<a name="l00736"></a>00736             <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a08a1d58c683814b6c845e3bb6328fd82">XML_SERIALIZER_OPTION_TYPEHINTS</a>] === <span class="keyword">true</span>) {
<a name="l00737"></a>00737                 $rootAttributes[$this-&gt;
<a name="l00738"></a>00738                     options[XML_SERIALIZER_OPTION_ATTRIBUTE_TYPE]] = gettype($data);
<a name="l00739"></a>00739             }
<a name="l00740"></a>00740 
<a name="l00741"></a>00741             <span class="keywordflow">if</span> (!is_bool($data)) {
<a name="l00742"></a>00742                 $tag[<span class="stringliteral">&#39;content&#39;</span>] = $data;
<a name="l00743"></a>00743             } elseif ($data === <span class="keyword">false</span>) {
<a name="l00744"></a>00744                 <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#ac17c094fe95de16efcfd93dd2538b2a6">XML_SERIALIZER_OPTION_FALSE_AS_STRING</a>] === <span class="keyword">true</span>) {
<a name="l00745"></a>00745                     $tag[<span class="stringliteral">&#39;content&#39;</span>] = <span class="charliteral">&#39;0&#39;</span>;
<a name="l00746"></a>00746                 } <span class="keywordflow">else</span> {
<a name="l00747"></a>00747                     $tag[<span class="stringliteral">&#39;content&#39;</span>] = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00748"></a>00748                 }
<a name="l00749"></a>00749             } <span class="keywordflow">else</span> {
<a name="l00750"></a>00750                 $tag[<span class="stringliteral">&#39;content&#39;</span>] = $data;
<a name="l00751"></a>00751             }
<a name="l00752"></a>00752 
<a name="l00753"></a>00753             @settype($data, <span class="stringliteral">&#39;string&#39;</span>);
<a name="l00754"></a>00754             $tag[<span class="stringliteral">&#39;attributes&#39;</span>]     = $rootAttributes;
<a name="l00755"></a>00755             $this-&gt;_serializedData = $this-&gt;<a class="code" href="class_x_m_l___serializer.html#a2c0485ff60945e8138c7dae5c67dbf18">_createXMLTag</a>($tag);
<a name="l00756"></a>00756         }
<a name="l00757"></a>00757 
<a name="l00758"></a>00758         <span class="comment">// add doctype declaration</span>
<a name="l00759"></a>00759         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a488e818cd19eac676fb63fbcf60ef361">XML_SERIALIZER_OPTION_DOCTYPE_ENABLED</a>] === <span class="keyword">true</span>) {
<a name="l00760"></a>00760             $this-&gt;_serializedData =
<a name="l00761"></a>00761                 XML_Util::getDoctypeDeclaration($tagName,
<a name="l00762"></a>00762                 $this-&gt;options[<a class="code" href="_serializer_8php.html#a65694b9a6deebf5212d064df07a5f31b">XML_SERIALIZER_OPTION_DOCTYPE</a>])
<a name="l00763"></a>00763                 . $this-&gt;options[XML_SERIALIZER_OPTION_LINEBREAKS]
<a name="l00764"></a>00764                 . $this-&gt;_serializedData;
<a name="l00765"></a>00765         }
<a name="l00766"></a>00766 
<a name="l00767"></a>00767         <span class="comment">//  build xml declaration</span>
<a name="l00768"></a>00768         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a494042182bfc56022a5510cf9ce5507f">XML_SERIALIZER_OPTION_XML_DECL_ENABLED</a>]) {
<a name="l00769"></a>00769             $atts                  = array();
<a name="l00770"></a>00770             $this-&gt;_serializedData = <a class="code" href="class_x_m_l___util.html#adc0377b806c5851b4a4717f49d08e6d3">XML_Util::getXMLDeclaration</a>(<span class="stringliteral">&#39;1.0&#39;</span>,
<a name="l00771"></a>00771                 $this-&gt;options[<a class="code" href="_serializer_8php.html#a89f1f32653b232d0b5b2ec277aa004e0">XML_SERIALIZER_OPTION_XML_ENCODING</a>])
<a name="l00772"></a>00772                 . $this-&gt;options[XML_SERIALIZER_OPTION_LINEBREAKS]
<a name="l00773"></a>00773                 . $this-&gt;_serializedData;
<a name="l00774"></a>00774         }
<a name="l00775"></a>00775 
<a name="l00776"></a>00776         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a9397219c6d9e0f6c1f7170ea6da29e80">XML_SERIALIZER_OPTION_RETURN_RESULT</a>] === <span class="keyword">true</span>) {
<a name="l00777"></a>00777             $result = $this-&gt;_serializedData;
<a name="l00778"></a>00778         } <span class="keywordflow">else</span> {
<a name="l00779"></a>00779             $result = <span class="keyword">true</span>;
<a name="l00780"></a>00780         }
<a name="l00781"></a>00781 
<a name="l00782"></a>00782         <span class="keywordflow">if</span> ($optionsBak !== null) {
<a name="l00783"></a>00783             $this-&gt;options = $optionsBak;
<a name="l00784"></a>00784         }
<a name="l00785"></a>00785 
<a name="l00786"></a>00786         <span class="keywordflow">return</span> $result;
<a name="l00787"></a>00787     }
<a name="l00788"></a>00788 
<a name="l00795"></a><a class="code" href="class_x_m_l___serializer.html#a494cf7c0efdc822503124ce499ad5c2e">00795</a>     function <a class="code" href="class_x_m_l___serializer.html#a494cf7c0efdc822503124ce499ad5c2e">getSerializedData</a>()
<a name="l00796"></a>00796     {
<a name="l00797"></a>00797         <span class="keywordflow">if</span> ($this-&gt;_serializedData == null) {
<a name="l00798"></a>00798             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_p_e_a_r.html#a0ab3d4f101ecbf44db325ea332943640">raiseError</a>(<span class="stringliteral">&#39;No serialized data available. &#39;</span>
<a name="l00799"></a>00799                 . <span class="stringliteral">&#39;Use XML_Serializer::serialize() first.&#39;</span>,
<a name="l00800"></a>00800                 <a class="code" href="_serializer_8php.html#a086cfb1201cb5ea73e7ff455e6154d54">XML_SERIALIZER_ERROR_NO_SERIALIZATION</a>);
<a name="l00801"></a>00801         }
<a name="l00802"></a>00802         <span class="keywordflow">return</span> $this-&gt;_serializedData;
<a name="l00803"></a>00803     }
<a name="l00804"></a>00804 
<a name="l00817"></a><a class="code" href="class_x_m_l___serializer.html#a230575699cf6695ae8da0e885f75d39f">00817</a>     function <a class="code" href="class_x_m_l___serializer.html#a230575699cf6695ae8da0e885f75d39f">_serializeValue</a>($value, $tagName = null, $attributes = array())
<a name="l00818"></a>00818     {
<a name="l00819"></a>00819         <span class="keywordflow">if</span> (is_array($value)) {
<a name="l00820"></a>00820             $xml = $this-&gt;<a class="code" href="class_x_m_l___serializer.html#aef75df6dd1978c4930921a0234b3a0cb">_serializeArray</a>($value, $tagName, $attributes);
<a name="l00821"></a>00821         } elseif (is_object($value)) {
<a name="l00822"></a>00822             $xml = $this-&gt;<a class="code" href="class_x_m_l___serializer.html#ad18824472f27e7473da357e81dfcfccd">_serializeObject</a>($value, $tagName);
<a name="l00823"></a>00823         } <span class="keywordflow">else</span> {
<a name="l00824"></a>00824             $tag = array(
<a name="l00825"></a>00825                           <span class="stringliteral">&#39;qname&#39;</span>      =&gt; $tagName,
<a name="l00826"></a>00826                           <span class="stringliteral">&#39;attributes&#39;</span> =&gt; $attributes,
<a name="l00827"></a>00827                           <span class="stringliteral">&#39;content&#39;</span>    =&gt; $value
<a name="l00828"></a>00828                         );
<a name="l00829"></a>00829             $xml = $this-&gt;<a class="code" href="class_x_m_l___serializer.html#a2c0485ff60945e8138c7dae5c67dbf18">_createXMLTag</a>($tag);
<a name="l00830"></a>00830         }
<a name="l00831"></a>00831         <span class="keywordflow">return</span> $xml;
<a name="l00832"></a>00832     }
<a name="l00833"></a>00833 
<a name="l00849"></a><a class="code" href="class_x_m_l___serializer.html#aef75df6dd1978c4930921a0234b3a0cb">00849</a>     function <a class="code" href="class_x_m_l___serializer.html#aef75df6dd1978c4930921a0234b3a0cb">_serializeArray</a>(&amp;$array, $tagName = null, $attributes = array())
<a name="l00850"></a>00850     {
<a name="l00851"></a>00851         $_content = null;
<a name="l00852"></a>00852         $_comment = null;
<a name="l00853"></a>00853 
<a name="l00854"></a>00854         <span class="comment">// check for comment</span>
<a name="l00855"></a>00855         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#abc8d4638b30bb6c87b72fb92b39812e8">XML_SERIALIZER_OPTION_COMMENT_KEY</a>] !== null) {
<a name="l00856"></a>00856             <span class="keywordflow">if</span> (isset($array[$this-&gt;options[<a class="code" href="_serializer_8php.html#abc8d4638b30bb6c87b72fb92b39812e8">XML_SERIALIZER_OPTION_COMMENT_KEY</a>]])
<a name="l00857"></a>00857             ) {
<a name="l00858"></a>00858                 $_comment =
<a name="l00859"></a>00859                     $array[$this-&gt;options[XML_SERIALIZER_OPTION_COMMENT_KEY]];
<a name="l00860"></a>00860                 unset($array[$this-&gt;options[XML_SERIALIZER_OPTION_COMMENT_KEY]]);
<a name="l00861"></a>00861             }
<a name="l00862"></a>00862         }
<a name="l00863"></a>00863 
<a name="l00867"></a>00867         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a49251f2f3d7201d79b00d3475729c1c2">XML_SERIALIZER_OPTION_ATTRIBUTES_KEY</a>] !== null) {
<a name="l00868"></a>00868             <span class="keywordflow">if</span> (isset($array[$this-&gt;options[<a class="code" href="_serializer_8php.html#a49251f2f3d7201d79b00d3475729c1c2">XML_SERIALIZER_OPTION_ATTRIBUTES_KEY</a>]])
<a name="l00869"></a>00869             ) {
<a name="l00870"></a>00870                 $attributes =
<a name="l00871"></a>00871                     $array[$this-&gt;options[XML_SERIALIZER_OPTION_ATTRIBUTES_KEY]];
<a name="l00872"></a>00872                 unset($array[$this-&gt;options[XML_SERIALIZER_OPTION_ATTRIBUTES_KEY]]);
<a name="l00873"></a>00873             }
<a name="l00877"></a>00877             <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a724a2fd86d1465fbc225263f05116662">XML_SERIALIZER_OPTION_CONTENT_KEY</a>] !== null) {
<a name="l00878"></a>00878                 <span class="keywordflow">if</span> (isset($array[$this-&gt;options[<a class="code" href="_serializer_8php.html#a724a2fd86d1465fbc225263f05116662">XML_SERIALIZER_OPTION_CONTENT_KEY</a>]])
<a name="l00879"></a>00879                 ) {
<a name="l00880"></a>00880                     $_content =
<a name="l00881"></a>00881                         <a class="code" href="class_x_m_l___util.html#a6012bf0ccf04ea3a37228204d639ec6f">XML_Util::replaceEntities</a>($array
<a name="l00882"></a>00882                         [$this-&gt;options[XML_SERIALIZER_OPTION_CONTENT_KEY]]);
<a name="l00883"></a>00883                     unset($array[$this-&gt;options[XML_SERIALIZER_OPTION_CONTENT_KEY]]);
<a name="l00884"></a>00884                 }
<a name="l00885"></a>00885             }
<a name="l00886"></a>00886         }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#aba78fedad0ac0d125f3e87dcd32f8637">XML_SERIALIZER_OPTION_IGNORE_NULL</a>] === <span class="keyword">true</span>) {
<a name="l00889"></a>00889             <span class="keywordflow">foreach</span> (array_keys($array) as $key) {
<a name="l00890"></a>00890                 <span class="keywordflow">if</span> (is_null($array[$key])) {
<a name="l00891"></a>00891                     unset($array[$key]);
<a name="l00892"></a>00892                 }
<a name="l00893"></a>00893             }
<a name="l00894"></a>00894         }
<a name="l00895"></a>00895 
<a name="l00896"></a>00896         <span class="comment">/*</span>
<a name="l00897"></a>00897 <span class="comment">        * if mode is set to simpleXML, check whether</span>
<a name="l00898"></a>00898 <span class="comment">        * the array is associative or indexed</span>
<a name="l00899"></a>00899 <span class="comment">        */</span>
<a name="l00900"></a>00900         <span class="keywordflow">if</span> (is_array($array) &amp;&amp; !empty($array)
<a name="l00901"></a>00901             &amp;&amp; $this-&gt;options[<a class="code" href="_serializer_8php.html#a60e94edf1c7b4c915683c7b513431c0a">XML_SERIALIZER_OPTION_MODE</a>]
<a name="l00902"></a>00902             == <a class="code" href="_serializer_8php.html#afc78afcfbbaf118a2e69c2354485ceb7">XML_SERIALIZER_MODE_SIMPLEXML</a>
<a name="l00903"></a>00903         ) {
<a name="l00904"></a>00904             $indexed = <span class="keyword">true</span>;
<a name="l00905"></a>00905             <span class="keywordflow">foreach</span> ($array as $key =&gt; $val) {
<a name="l00906"></a>00906                 <span class="keywordflow">if</span> (!is_int($key)) {
<a name="l00907"></a>00907                     $indexed = <span class="keyword">false</span>;
<a name="l00908"></a>00908                     <span class="keywordflow">break</span>;
<a name="l00909"></a>00909                 }
<a name="l00910"></a>00910             }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912             <span class="keywordflow">if</span> ($indexed
<a name="l00913"></a>00913                 &amp;&amp; $this-&gt;options[<a class="code" href="_serializer_8php.html#a60e94edf1c7b4c915683c7b513431c0a">XML_SERIALIZER_OPTION_MODE</a>]
<a name="l00914"></a>00914                 == <a class="code" href="_serializer_8php.html#afc78afcfbbaf118a2e69c2354485ceb7">XML_SERIALIZER_MODE_SIMPLEXML</a>
<a name="l00915"></a>00915             ) {
<a name="l00916"></a>00916                 $string = <span class="stringliteral">&#39;&#39;</span>;
<a name="l00917"></a>00917                 <span class="keywordflow">foreach</span> ($array as $key =&gt; $val) {
<a name="l00918"></a>00918                     $string .= $this-&gt;<a class="code" href="class_x_m_l___serializer.html#a230575699cf6695ae8da0e885f75d39f">_serializeValue</a>($val, $tagName, $attributes);
<a name="l00919"></a>00919 
<a name="l00920"></a>00920                     $string .= $this-&gt;options[XML_SERIALIZER_OPTION_LINEBREAKS];
<a name="l00921"></a>00921                     <span class="comment">// do indentation</span>
<a name="l00922"></a>00922                     <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>]!==null
<a name="l00923"></a>00923                         &amp;&amp; $this-&gt;_tagDepth&gt;0
<a name="l00924"></a>00924                     ) {
<a name="l00925"></a>00925                         $string .=
<a name="l00926"></a>00926                             str_repeat($this-&gt;options[<a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>],
<a name="l00927"></a>00927                             $this-&gt;_tagDepth);
<a name="l00928"></a>00928                     }
<a name="l00929"></a>00929                 }
<a name="l00930"></a>00930                 <span class="keywordflow">return</span> rtrim($string);
<a name="l00931"></a>00931             }
<a name="l00932"></a>00932         }
<a name="l00933"></a>00933 
<a name="l00934"></a>00934         $scalarAsAttributes = <span class="keyword">false</span>;
<a name="l00935"></a>00935         <span class="keywordflow">if</span> (is_array($this-&gt;options[<a class="code" href="_serializer_8php.html#a9f9df02f2006bc251261e409e87a2113">XML_SERIALIZER_OPTION_SCALAR_AS_ATTRIBUTES</a>])
<a name="l00936"></a>00936             &amp;&amp; isset($this-&gt;options[XML_SERIALIZER_OPTION_SCALAR_AS_ATTRIBUTES]
<a name="l00937"></a>00937             [$tagName])
<a name="l00938"></a>00938         ) {
<a name="l00939"></a>00939             $scalarAsAttributes =
<a name="l00940"></a>00940                 $this-&gt;options[XML_SERIALIZER_OPTION_SCALAR_AS_ATTRIBUTES][$tagName];
<a name="l00941"></a>00941         } elseif ($this-&gt;options[XML_SERIALIZER_OPTION_SCALAR_AS_ATTRIBUTES] === <span class="keyword">true</span>
<a name="l00942"></a>00942         ) {
<a name="l00943"></a>00943             $scalarAsAttributes = <span class="keyword">true</span>;
<a name="l00944"></a>00944         }
<a name="l00945"></a>00945 
<a name="l00946"></a>00946         <span class="keywordflow">if</span> ($scalarAsAttributes === <span class="keyword">true</span>) {
<a name="l00947"></a>00947             $this-&gt;<a class="code" href="class_p_e_a_r.html#ae2bf55e7218f97afc96039d557c7fcae">expectError</a>(<span class="charliteral">&#39;*&#39;</span>);
<a name="l00948"></a>00948             <span class="keywordflow">foreach</span> ($array as $key =&gt; $value) {
<a name="l00949"></a>00949                 <span class="keywordflow">if</span> (is_scalar($value) &amp;&amp; (<a class="code" href="class_x_m_l___util.html#a96596f96c56eca106c7d4a509dbbbc89">XML_Util::isValidName</a>($key) === <span class="keyword">true</span>)) {
<a name="l00950"></a>00950                     unset($array[$key]);
<a name="l00951"></a>00951                     $attributes[$this-&gt;options
<a name="l00952"></a>00952                         [XML_SERIALIZER_OPTION_PREPEND_ATTRIBUTES].$key] = $value;
<a name="l00953"></a>00953                 }
<a name="l00954"></a>00954             }
<a name="l00955"></a>00955             $this-&gt;<a class="code" href="class_p_e_a_r.html#a80ecc56c9d0937eea105c13edbd741d1">popExpect</a>();
<a name="l00956"></a>00956         } elseif (is_array($scalarAsAttributes)) {
<a name="l00957"></a>00957             $this-&gt;<a class="code" href="class_p_e_a_r.html#ae2bf55e7218f97afc96039d557c7fcae">expectError</a>(<span class="charliteral">&#39;*&#39;</span>);
<a name="l00958"></a>00958             <span class="keywordflow">foreach</span> ($scalarAsAttributes as $key) {
<a name="l00959"></a>00959                 <span class="keywordflow">if</span> (!isset($array[$key])) {
<a name="l00960"></a>00960                     <span class="keywordflow">continue</span>;
<a name="l00961"></a>00961                 }
<a name="l00962"></a>00962                 $value = $array[$key];
<a name="l00963"></a>00963                 <span class="keywordflow">if</span> (is_scalar($value) &amp;&amp; (<a class="code" href="class_x_m_l___util.html#a96596f96c56eca106c7d4a509dbbbc89">XML_Util::isValidName</a>($key) === <span class="keyword">true</span>)) {
<a name="l00964"></a>00964                     unset($array[$key]);
<a name="l00965"></a>00965                     $attributes[$this-&gt;options
<a name="l00966"></a>00966                         [XML_SERIALIZER_OPTION_PREPEND_ATTRIBUTES].$key] = $value;
<a name="l00967"></a>00967                 }
<a name="l00968"></a>00968             }
<a name="l00969"></a>00969             $this-&gt;<a class="code" href="class_p_e_a_r.html#a80ecc56c9d0937eea105c13edbd741d1">popExpect</a>();
<a name="l00970"></a>00970         }
<a name="l00971"></a>00971 
<a name="l00972"></a>00972         <span class="comment">// check for empty array =&gt; create empty tag</span>
<a name="l00973"></a>00973         <span class="keywordflow">if</span> (empty($array)) {
<a name="l00974"></a>00974             $tag = array(
<a name="l00975"></a>00975                             <span class="stringliteral">&#39;qname&#39;</span>      =&gt; $tagName,
<a name="l00976"></a>00976                             <span class="stringliteral">&#39;content&#39;</span>    =&gt; $_content,
<a name="l00977"></a>00977                             <span class="stringliteral">&#39;attributes&#39;</span> =&gt; $attributes
<a name="l00978"></a>00978                         );
<a name="l00979"></a>00979         } <span class="keywordflow">else</span> {
<a name="l00980"></a>00980             $this-&gt;_tagDepth++;
<a name="l00981"></a>00981             $tmp = $_content . $this-&gt;options[XML_SERIALIZER_OPTION_LINEBREAKS];
<a name="l00982"></a>00982             <span class="keywordflow">foreach</span> ($array as $key =&gt; $value) {
<a name="l00983"></a>00983                 <span class="comment">// do indentation</span>
<a name="l00984"></a>00984                 <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>]!==null
<a name="l00985"></a>00985                     &amp;&amp; $this-&gt;_tagDepth&gt;0
<a name="l00986"></a>00986                 ) {
<a name="l00987"></a>00987                     $tmp .= str_repeat($this-&gt;options[<a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>],
<a name="l00988"></a>00988                         $this-&gt;_tagDepth);
<a name="l00989"></a>00989                 }
<a name="l00990"></a>00990 
<a name="l00991"></a>00991                 <span class="comment">// copy key</span>
<a name="l00992"></a>00992                 $origKey = $key;
<a name="l00993"></a>00993                 $this-&gt;<a class="code" href="class_p_e_a_r.html#ae2bf55e7218f97afc96039d557c7fcae">expectError</a>(<span class="charliteral">&#39;*&#39;</span>);
<a name="l00994"></a>00994                 <span class="comment">// key cannot be used as tagname =&gt; use default tag</span>
<a name="l00995"></a>00995                 $valid = <a class="code" href="class_x_m_l___util.html#a96596f96c56eca106c7d4a509dbbbc89">XML_Util::isValidName</a>($key);
<a name="l00996"></a>00996                 $this-&gt;<a class="code" href="class_p_e_a_r.html#a80ecc56c9d0937eea105c13edbd741d1">popExpect</a>();
<a name="l00997"></a>00997                 <span class="keywordflow">if</span> (<a class="code" href="class_p_e_a_r.html#a55ae0955466c3970507b122f3f5d1b38">PEAR::isError</a>($valid)) {
<a name="l00998"></a>00998                     <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#adca0a003be64fda910384e27ff2e9647">XML_SERIALIZER_OPTION_CLASSNAME_AS_TAGNAME</a>]
<a name="l00999"></a>00999                         &amp;&amp; is_object($value)
<a name="l01000"></a>01000                     ) {
<a name="l01001"></a>01001                         $key = get_class($value);
<a name="l01002"></a>01002                     } <span class="keywordflow">else</span> {
<a name="l01003"></a>01003                         $key = $this-&gt;<a class="code" href="class_x_m_l___serializer.html#a568ca37d4ef82b164704f7321e86c6f1">_getDefaultTagname</a>($tagName);
<a name="l01004"></a>01004                     }
<a name="l01005"></a>01005                 }
<a name="l01006"></a>01006 
<a name="l01007"></a>01007                 <span class="comment">// once we&#39;ve established the true $key, is there a tagmap for it?</span>
<a name="l01008"></a>01008                 <span class="keywordflow">if</span> (isset($this-&gt;options[<a class="code" href="_serializer_8php.html#a1a1c0bb60dea9eeaa5e38f0b0760bfeb">XML_SERIALIZER_OPTION_TAGMAP</a>][$key])) {
<a name="l01009"></a>01009                     $key = $this-&gt;options[XML_SERIALIZER_OPTION_TAGMAP][$key];
<a name="l01010"></a>01010                 }
<a name="l01011"></a>01011 
<a name="l01012"></a>01012                 $atts = array();
<a name="l01013"></a>01013                 <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a08a1d58c683814b6c845e3bb6328fd82">XML_SERIALIZER_OPTION_TYPEHINTS</a>] === <span class="keyword">true</span>) {
<a name="l01014"></a>01014                     $atts[$this-&gt;options[XML_SERIALIZER_OPTION_ATTRIBUTE_TYPE]] =
<a name="l01015"></a>01015                         gettype($value);
<a name="l01016"></a>01016                     <span class="keywordflow">if</span> ($key !== $origKey) {
<a name="l01017"></a>01017                         $atts[$this-&gt;options[XML_SERIALIZER_OPTION_ATTRIBUTE_KEY]] =
<a name="l01018"></a>01018                             (string)$origKey;
<a name="l01019"></a>01019                     }
<a name="l01020"></a>01020                 }
<a name="l01021"></a>01021 
<a name="l01022"></a>01022                 $tmp .= $this-&gt;<a class="code" href="class_x_m_l___serializer.html#a2c0485ff60945e8138c7dae5c67dbf18">_createXMLTag</a>(array(
<a name="l01023"></a>01023                     <span class="stringliteral">&#39;qname&#39;</span>      =&gt; $key,
<a name="l01024"></a>01024                     <span class="stringliteral">&#39;attributes&#39;</span> =&gt; $atts,
<a name="l01025"></a>01025                     <span class="stringliteral">&#39;content&#39;</span>    =&gt; $value
<a name="l01026"></a>01026                 ));
<a name="l01027"></a>01027                 $tmp .= $this-&gt;options[XML_SERIALIZER_OPTION_LINEBREAKS];
<a name="l01028"></a>01028             }
<a name="l01029"></a>01029 
<a name="l01030"></a>01030             $this-&gt;_tagDepth--;
<a name="l01031"></a>01031             <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>]!==null
<a name="l01032"></a>01032                 &amp;&amp; $this-&gt;_tagDepth&gt;0
<a name="l01033"></a>01033             ) {
<a name="l01034"></a>01034                 $tmp .= str_repeat($this-&gt;options[<a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>],
<a name="l01035"></a>01035                     $this-&gt;_tagDepth);
<a name="l01036"></a>01036             }
<a name="l01037"></a>01037 
<a name="l01038"></a>01038             <span class="keywordflow">if</span> (trim($tmp) === <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01039"></a>01039                 $tmp = null;
<a name="l01040"></a>01040             }
<a name="l01041"></a>01041 
<a name="l01042"></a>01042             $tag = array(
<a name="l01043"></a>01043                           <span class="stringliteral">&#39;qname&#39;</span>      =&gt; $tagName,
<a name="l01044"></a>01044                           <span class="stringliteral">&#39;content&#39;</span>    =&gt; $tmp,
<a name="l01045"></a>01045                           <span class="stringliteral">&#39;attributes&#39;</span> =&gt; $attributes
<a name="l01046"></a>01046                         );
<a name="l01047"></a>01047         }
<a name="l01048"></a>01048         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a08a1d58c683814b6c845e3bb6328fd82">XML_SERIALIZER_OPTION_TYPEHINTS</a>] === <span class="keyword">true</span>) {
<a name="l01049"></a>01049             <span class="keywordflow">if</span> (!isset($tag[<span class="stringliteral">&#39;attributes&#39;</span>]
<a name="l01050"></a>01050                 [$this-&gt;options[<a class="code" href="_serializer_8php.html#a133333002b170bd4b14dacea5e35106b">XML_SERIALIZER_OPTION_ATTRIBUTE_TYPE</a>]])
<a name="l01051"></a>01051             ) {
<a name="l01052"></a>01052                 $tag[<span class="stringliteral">&#39;attributes&#39;</span>]
<a name="l01053"></a>01053                     [$this-&gt;options[XML_SERIALIZER_OPTION_ATTRIBUTE_TYPE]] = <span class="stringliteral">&#39;array&#39;</span>;
<a name="l01054"></a>01054             }
<a name="l01055"></a>01055         }
<a name="l01056"></a>01056 
<a name="l01057"></a>01057         $string = <span class="stringliteral">&#39;&#39;</span>;
<a name="l01058"></a>01058         <span class="keywordflow">if</span> (!is_null($_comment)) {
<a name="l01059"></a>01059             $string .= <a class="code" href="class_x_m_l___util.html#ab6ee7f8cd1e1ca3ec14f9a8d7c6b27bb">XML_Util::createComment</a>($_comment);
<a name="l01060"></a>01060             $string .= $this-&gt;options[XML_SERIALIZER_OPTION_LINEBREAKS];
<a name="l01061"></a>01061             <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>]!==null
<a name="l01062"></a>01062                 &amp;&amp; $this-&gt;_tagDepth&gt;0
<a name="l01063"></a>01063             ) {
<a name="l01064"></a>01064                 $string .= str_repeat($this-&gt;options[<a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>],
<a name="l01065"></a>01065                     $this-&gt;_tagDepth);
<a name="l01066"></a>01066             }
<a name="l01067"></a>01067         }
<a name="l01068"></a>01068         $string .= $this-&gt;<a class="code" href="class_x_m_l___serializer.html#a2c0485ff60945e8138c7dae5c67dbf18">_createXMLTag</a>($tag, <span class="keyword">false</span>);
<a name="l01069"></a>01069         <span class="keywordflow">return</span> $string;
<a name="l01070"></a>01070     }
<a name="l01071"></a>01071 
<a name="l01082"></a><a class="code" href="class_x_m_l___serializer.html#a568ca37d4ef82b164704f7321e86c6f1">01082</a>     function <a class="code" href="class_x_m_l___serializer.html#a568ca37d4ef82b164704f7321e86c6f1">_getDefaultTagname</a>($parent)
<a name="l01083"></a>01083     {
<a name="l01084"></a>01084         <span class="keywordflow">if</span> (is_string($this-&gt;options[<a class="code" href="_serializer_8php.html#a2219421bee07847f1bf695cb7ab4953a">XML_SERIALIZER_OPTION_DEFAULT_TAG</a>])) {
<a name="l01085"></a>01085             <span class="keywordflow">return</span> $this-&gt;options[XML_SERIALIZER_OPTION_DEFAULT_TAG];
<a name="l01086"></a>01086         }
<a name="l01087"></a>01087         <span class="keywordflow">if</span> (isset($this-&gt;options[XML_SERIALIZER_OPTION_DEFAULT_TAG][$parent])) {
<a name="l01088"></a>01088             <span class="keywordflow">return</span> $this-&gt;options[XML_SERIALIZER_OPTION_DEFAULT_TAG][$parent];
<a name="l01089"></a>01089         } elseif (isset($this-&gt;options[XML_SERIALIZER_OPTION_DEFAULT_TAG]
<a name="l01090"></a>01090             [<span class="stringliteral">&#39;#default&#39;</span>])
<a name="l01091"></a>01091         ) {
<a name="l01092"></a>01092             <span class="keywordflow">return</span> $this-&gt;options[XML_SERIALIZER_OPTION_DEFAULT_TAG][<span class="stringliteral">&#39;#default&#39;</span>];
<a name="l01093"></a>01093         } elseif (isset($this-&gt;options[XML_SERIALIZER_OPTION_DEFAULT_TAG]
<a name="l01094"></a>01094             [<span class="stringliteral">&#39;__default&#39;</span>])
<a name="l01095"></a>01095         ) {
<a name="l01096"></a>01096             <span class="comment">// keep this for BC</span>
<a name="l01097"></a>01097             <span class="keywordflow">return</span> $this-&gt;options[XML_SERIALIZER_OPTION_DEFAULT_TAG][<span class="stringliteral">&#39;__default&#39;</span>];
<a name="l01098"></a>01098         }
<a name="l01099"></a>01099         <span class="keywordflow">return</span> <span class="stringliteral">&#39;XML_Serializer_Tag&#39;</span>;
<a name="l01100"></a>01100     }
<a name="l01101"></a>01101 
<a name="l01112"></a><a class="code" href="class_x_m_l___serializer.html#ad18824472f27e7473da357e81dfcfccd">01112</a>     function <a class="code" href="class_x_m_l___serializer.html#ad18824472f27e7473da357e81dfcfccd">_serializeObject</a>(&amp;$object, $tagName = null, $attributes = array())
<a name="l01113"></a>01113     {
<a name="l01114"></a>01114         <span class="comment">// check for magic function</span>
<a name="l01115"></a>01115         <span class="keywordflow">if</span> (method_exists($object, <span class="stringliteral">&#39;__sleep&#39;</span>)) {
<a name="l01116"></a>01116             $propNames = $object-&gt;__sleep();
<a name="l01117"></a>01117             <span class="keywordflow">if</span> (is_array($propNames)) {
<a name="l01118"></a>01118                 $properties = array();
<a name="l01119"></a>01119                 <span class="keywordflow">foreach</span> ($propNames as $propName) {
<a name="l01120"></a>01120                     $properties[$propName] = $object-&gt;$propName;
<a name="l01121"></a>01121                 }
<a name="l01122"></a>01122             } <span class="keywordflow">else</span> {
<a name="l01123"></a>01123                 $properties = get_object_vars($object);
<a name="l01124"></a>01124             }
<a name="l01125"></a>01125         } <span class="keywordflow">else</span> {
<a name="l01126"></a>01126             $properties = get_object_vars($object);
<a name="l01127"></a>01127         }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129         <span class="keywordflow">if</span> (empty($tagName)) {
<a name="l01130"></a>01130             $tagName = get_class($object);
<a name="l01131"></a>01131         }
<a name="l01132"></a>01132 
<a name="l01133"></a>01133         <span class="comment">// typehints activated?</span>
<a name="l01134"></a>01134         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a08a1d58c683814b6c845e3bb6328fd82">XML_SERIALIZER_OPTION_TYPEHINTS</a>] === <span class="keyword">true</span>) {
<a name="l01135"></a>01135             $attributes[$this-&gt;options[XML_SERIALIZER_OPTION_ATTRIBUTE_TYPE]]  =
<a name="l01136"></a>01136                 <span class="stringliteral">&#39;object&#39;</span>;
<a name="l01137"></a>01137             $attributes[$this-&gt;options[XML_SERIALIZER_OPTION_ATTRIBUTE_CLASS]] =
<a name="l01138"></a>01138                 get_class($object);
<a name="l01139"></a>01139         }
<a name="l01140"></a>01140         $string = $this-&gt;<a class="code" href="class_x_m_l___serializer.html#aef75df6dd1978c4930921a0234b3a0cb">_serializeArray</a>($properties, $tagName, $attributes);
<a name="l01141"></a>01141         <span class="keywordflow">return</span> $string;
<a name="l01142"></a>01142     }
<a name="l01143"></a>01143 
<a name="l01161"></a><a class="code" href="class_x_m_l___serializer.html#a2c0485ff60945e8138c7dae5c67dbf18">01161</a>     function <a class="code" href="class_x_m_l___serializer.html#a2c0485ff60945e8138c7dae5c67dbf18">_createXMLTag</a>($tag, $firstCall = <span class="keyword">true</span>)
<a name="l01162"></a>01162     {
<a name="l01163"></a>01163         <span class="comment">// build fully qualified tag name</span>
<a name="l01164"></a>01164         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#ad2115407b3bceb1618b68bda565946fa">XML_SERIALIZER_OPTION_NAMESPACE</a>] !== null) {
<a name="l01165"></a>01165             <span class="keywordflow">if</span> (is_array($this-&gt;options[<a class="code" href="_serializer_8php.html#ad2115407b3bceb1618b68bda565946fa">XML_SERIALIZER_OPTION_NAMESPACE</a>])) {
<a name="l01166"></a>01166                 $tag[<span class="stringliteral">&#39;qname&#39;</span>] = $this-&gt;options[XML_SERIALIZER_OPTION_NAMESPACE][0]
<a name="l01167"></a>01167                     . <span class="charliteral">&#39;:&#39;</span> . $tag[<span class="stringliteral">&#39;qname&#39;</span>];
<a name="l01168"></a>01168             } <span class="keywordflow">else</span> {
<a name="l01169"></a>01169                 $tag[<span class="stringliteral">&#39;qname&#39;</span>] = $this-&gt;options[XML_SERIALIZER_OPTION_NAMESPACE]
<a name="l01170"></a>01170                     . <span class="charliteral">&#39;:&#39;</span> . $tag[<span class="stringliteral">&#39;qname&#39;</span>];
<a name="l01171"></a>01171             }
<a name="l01172"></a>01172         }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174         <span class="comment">// attribute indentation</span>
<a name="l01175"></a>01175         <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a99841118deeaafb03c916e869259ee2a">XML_SERIALIZER_OPTION_INDENT_ATTRIBUTES</a>] !== <span class="keyword">false</span>) {
<a name="l01176"></a>01176             $multiline = <span class="keyword">true</span>;
<a name="l01177"></a>01177             $indent    = str_repeat($this-&gt;options[<a class="code" href="_serializer_8php.html#a3986dd27fea5e4e2883ba2351d313b80">XML_SERIALIZER_OPTION_INDENT</a>],
<a name="l01178"></a>01178                 $this-&gt;_tagDepth);
<a name="l01179"></a>01179 
<a name="l01180"></a>01180             <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a99841118deeaafb03c916e869259ee2a">XML_SERIALIZER_OPTION_INDENT_ATTRIBUTES</a>] == <span class="stringliteral">&#39;_auto&#39;</span>) {
<a name="l01181"></a>01181                 $indent .= str_repeat(<span class="charliteral">&#39; &#39;</span>, (strlen($tag[<span class="stringliteral">&#39;qname&#39;</span>])+2));
<a name="l01182"></a>01182 
<a name="l01183"></a>01183             } <span class="keywordflow">else</span> {
<a name="l01184"></a>01184                 $indent .= $this-&gt;options[XML_SERIALIZER_OPTION_INDENT_ATTRIBUTES];
<a name="l01185"></a>01185             }
<a name="l01186"></a>01186         } <span class="keywordflow">else</span> {
<a name="l01187"></a>01187             $multiline = <span class="keyword">false</span>;
<a name="l01188"></a>01188             $indent    = <span class="keyword">false</span>;
<a name="l01189"></a>01189         }
<a name="l01190"></a>01190 
<a name="l01191"></a>01191         <span class="keywordflow">if</span> (is_array($tag[<span class="stringliteral">&#39;content&#39;</span>])) {
<a name="l01192"></a>01192             <span class="keywordflow">if</span> (empty($tag[<span class="stringliteral">&#39;content&#39;</span>])) {
<a name="l01193"></a>01193                 $tag[<span class="stringliteral">&#39;content&#39;</span>] =   <span class="stringliteral">&#39;&#39;</span>;
<a name="l01194"></a>01194             }
<a name="l01195"></a>01195 } elseif (<a class="code" href="_serializer_8php.html#ac17c094fe95de16efcfd93dd2538b2a6">XML_SERIALIZER_OPTION_FALSE_AS_STRING</a> &amp;&amp; $tag[<span class="stringliteral">&#39;content&#39;</span>] === <span class="keyword">false</span>) {
<a name="l01196"></a>01196 $tag[<span class="stringliteral">&#39;content&#39;</span>] = <span class="charliteral">&#39;0&#39;</span>;
<a name="l01197"></a>01197         } elseif (is_scalar($tag[<span class="stringliteral">&#39;content&#39;</span>]) &amp;&amp; (<span class="keywordtype">string</span>)$tag[<span class="stringliteral">&#39;content&#39;</span>] == <span class="stringliteral">&#39;&#39;</span>) {
<a name="l01198"></a>01198             $tag[<span class="stringliteral">&#39;content&#39;</span>] =   <span class="stringliteral">&#39;&#39;</span>;
<a name="l01199"></a>01199         }
<a name="l01200"></a>01200 
<a name="l01201"></a>01201         <span class="comment">// replace XML entities</span>
<a name="l01202"></a>01202         <span class="keywordflow">if</span> ($firstCall === <span class="keyword">true</span>) {
<a name="l01203"></a>01203             <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#acf9cdb6733963030fb9c3966aa1ff302">XML_SERIALIZER_OPTION_CDATA_SECTIONS</a>] === <span class="keyword">true</span>) {
<a name="l01204"></a>01204                 $replaceEntities = XML_UTIL_CDATA_SECTION;
<a name="l01205"></a>01205             } <span class="keywordflow">else</span> {
<a name="l01206"></a>01206                 $replaceEntities = $this-&gt;options[XML_SERIALIZER_OPTION_ENTITIES];
<a name="l01207"></a>01207             }
<a name="l01208"></a>01208         } <span class="keywordflow">else</span> {
<a name="l01209"></a>01209             <span class="comment">// this is a nested call, so value is already encoded</span>
<a name="l01210"></a>01210             <span class="comment">// and must not be encoded again</span>
<a name="l01211"></a>01211             $replaceEntities = XML_SERIALIZER_ENTITIES_NONE;
<a name="l01212"></a>01212             <span class="comment">// but attributes need to be encoded anyways</span>
<a name="l01213"></a>01213             <span class="comment">// (done here because the rest of the code assumes the same encoding</span>
<a name="l01214"></a>01214             <span class="comment">// can be used both for attributes and content)</span>
<a name="l01215"></a>01215             <span class="keywordflow">foreach</span> ($tag[<span class="stringliteral">&#39;attributes&#39;</span>] as $k =&gt; $v) {
<a name="l01216"></a>01216                 $v = <a class="code" href="class_x_m_l___util.html#a6012bf0ccf04ea3a37228204d639ec6f">XML_Util::replaceEntities</a>($v,
<a name="l01217"></a>01217                     $this-&gt;options[<a class="code" href="_serializer_8php.html#abc1a9ec8eaef8da1316ae2ce22289116">XML_SERIALIZER_OPTION_ENTITIES</a>]);
<a name="l01218"></a>01218 
<a name="l01219"></a>01219                 $tag[<span class="stringliteral">&#39;attributes&#39;</span>][$k] = $v;
<a name="l01220"></a>01220             }
<a name="l01221"></a>01221         }
<a name="l01222"></a>01222         <span class="keywordflow">if</span> (is_scalar($tag[<span class="stringliteral">&#39;content&#39;</span>]) || is_null($tag[<span class="stringliteral">&#39;content&#39;</span>])) {
<a name="l01223"></a>01223             <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a88165b7af2676f6353bb810ae7afc307">XML_SERIALIZER_OPTION_ENCODE_FUNC</a>]) {
<a name="l01224"></a>01224                 <span class="keywordflow">if</span> ($firstCall === <span class="keyword">true</span>) {
<a name="l01225"></a>01225                     $tag[<span class="stringliteral">&#39;content&#39;</span>] = call_user_func($this-&gt;
<a name="l01226"></a>01226                         options[XML_SERIALIZER_OPTION_ENCODE_FUNC], $tag[<span class="stringliteral">&#39;content&#39;</span>]);
<a name="l01227"></a>01227                 }
<a name="l01228"></a>01228                 $tag[<span class="stringliteral">&#39;attributes&#39;</span>] = array_map($this-&gt;
<a name="l01229"></a>01229                     options[XML_SERIALIZER_OPTION_ENCODE_FUNC], $tag[<span class="stringliteral">&#39;attributes&#39;</span>]);
<a name="l01230"></a>01230             }
<a name="l01231"></a>01231             $tag = <a class="code" href="class_x_m_l___util.html#aa269d90d3cb9f9082c79a8336f13d54f">XML_Util::createTagFromArray</a>($tag, $replaceEntities, $multiline,
<a name="l01232"></a>01232                 $indent, $this-&gt;options[<a class="code" href="_serializer_8php.html#afaef88d878b0f78977901cf0b5600588">XML_SERIALIZER_OPTION_LINEBREAKS</a>]);
<a name="l01233"></a>01233         } elseif (is_array($tag[<span class="stringliteral">&#39;content&#39;</span>])) {
<a name="l01234"></a>01234             $tag = $this-&gt;<a class="code" href="class_x_m_l___serializer.html#aef75df6dd1978c4930921a0234b3a0cb">_serializeArray</a>($tag[<span class="stringliteral">&#39;content&#39;</span>], $tag[<span class="stringliteral">&#39;qname&#39;</span>],
<a name="l01235"></a>01235                 $tag[<span class="stringliteral">&#39;attributes&#39;</span>]);
<a name="l01236"></a>01236         } elseif (is_object($tag[<span class="stringliteral">&#39;content&#39;</span>])) {
<a name="l01237"></a>01237             $tag = $this-&gt;<a class="code" href="class_x_m_l___serializer.html#ad18824472f27e7473da357e81dfcfccd">_serializeObject</a>($tag[<span class="stringliteral">&#39;content&#39;</span>], $tag[<span class="stringliteral">&#39;qname&#39;</span>],
<a name="l01238"></a>01238                 $tag[<span class="stringliteral">&#39;attributes&#39;</span>]);
<a name="l01239"></a>01239         } elseif (is_resource($tag[<span class="stringliteral">&#39;content&#39;</span>])) {
<a name="l01240"></a>01240             settype($tag[<span class="stringliteral">&#39;content&#39;</span>], <span class="stringliteral">&#39;string&#39;</span>);
<a name="l01241"></a>01241             <span class="keywordflow">if</span> ($this-&gt;options[<a class="code" href="_serializer_8php.html#a88165b7af2676f6353bb810ae7afc307">XML_SERIALIZER_OPTION_ENCODE_FUNC</a>]) {
<a name="l01242"></a>01242                 <span class="keywordflow">if</span> ($replaceEntities === <span class="keyword">true</span>) {
<a name="l01243"></a>01243                     $tag[<span class="stringliteral">&#39;content&#39;</span>] = call_user_func($this-&gt;
<a name="l01244"></a>01244                         options[XML_SERIALIZER_OPTION_ENCODE_FUNC], $tag[<span class="stringliteral">&#39;content&#39;</span>]);
<a name="l01245"></a>01245                 }
<a name="l01246"></a>01246                 $tag[<span class="stringliteral">&#39;attributes&#39;</span>] = array_map($this-&gt;
<a name="l01247"></a>01247                     options[XML_SERIALIZER_OPTION_ENCODE_FUNC],
<a name="l01248"></a>01248                     $tag[<span class="stringliteral">&#39;attributes&#39;</span>]);
<a name="l01249"></a>01249             }
<a name="l01250"></a>01250             $tag = <a class="code" href="class_x_m_l___util.html#aa269d90d3cb9f9082c79a8336f13d54f">XML_Util::createTagFromArray</a>($tag, $replaceEntities);
<a name="l01251"></a>01251         }
<a name="l01252"></a>01252         <span class="keywordflow">return</span>  $tag;
<a name="l01253"></a>01253     }
<a name="l01254"></a>01254 }
<a name="l01255"></a>01255 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Jul 7 2010 15:06:50 for zimbraControl by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
