<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>zimbraControl: classes/PEAR/XML/Parser.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>classes/PEAR/XML/Parser.php</h1>  </div>
</div>
<div class="contents">
<a href="_parser_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/* vim: set expandtab tabstop=4 shiftwidth=4 softtabstop=4: */</span>
<a name="l00004"></a>00004 
<a name="l00055"></a>00055 require_once <span class="stringliteral">&#39;PEAR.php&#39;</span>;
<a name="l00056"></a>00056 
<a name="l00060"></a><a class="code" href="_parser_8php.html#ac41c7c9c4ac68d6f5358c8e1b4966b23">00060</a> define(<span class="stringliteral">&#39;XML_PARSER_ERROR_NO_RESOURCE&#39;</span>, 200);
<a name="l00061"></a>00061 
<a name="l00065"></a><a class="code" href="_parser_8php.html#affaa73d6122f2552bf5ff9b49e754cd5">00065</a> define(<span class="stringliteral">&#39;XML_PARSER_ERROR_UNSUPPORTED_MODE&#39;</span>, 201);
<a name="l00066"></a>00066 
<a name="l00070"></a><a class="code" href="_parser_8php.html#a75f314519fa256467bf308404569345a">00070</a> define(<span class="stringliteral">&#39;XML_PARSER_ERROR_INVALID_ENCODING&#39;</span>, 202);
<a name="l00071"></a>00071 
<a name="l00075"></a><a class="code" href="_parser_8php.html#a488e4bb27a78c6e70c779fa08c47b07d">00075</a> define(<span class="stringliteral">&#39;XML_PARSER_ERROR_FILE_NOT_READABLE&#39;</span>, 203);
<a name="l00076"></a>00076 
<a name="l00080"></a><a class="code" href="_parser_8php.html#ab00af2c85bf62831ad87061b19012268">00080</a> define(<span class="stringliteral">&#39;XML_PARSER_ERROR_INVALID_INPUT&#39;</span>, 204);
<a name="l00081"></a>00081 
<a name="l00085"></a><a class="code" href="_parser_8php.html#a885b52cd12814e784e9d4403f0dcf766">00085</a> define(<span class="stringliteral">&#39;XML_PARSER_ERROR_REMOTE&#39;</span>, 205);
<a name="l00086"></a>00086 
<a name="l00116"></a><a class="code" href="class_x_m_l___parser.html">00116</a> <span class="keyword">class </span><a class="code" href="class_x_m_l___parser.html">XML_Parser</a> <span class="keyword">extends</span> <a class="code" href="class_p_e_a_r.html">PEAR</a>
<a name="l00117"></a>00117 {
<a name="l00118"></a>00118     <span class="comment">// {{{ properties</span>
<a name="l00119"></a>00119 
<a name="l00126"></a><a class="code" href="class_x_m_l___parser.html#a147a766daa03d52576c7345fea31c945">00126</a>     var <a class="code" href="class_x_m_l___parser.html#a147a766daa03d52576c7345fea31c945">$parser</a>;
<a name="l00127"></a>00127 
<a name="l00133"></a><a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">00133</a>     var <a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>;
<a name="l00134"></a>00134 
<a name="l00143"></a><a class="code" href="class_x_m_l___parser.html#af64719f1e001efc3d10e763e5863aac2">00143</a>     var <a class="code" href="class_x_m_l___parser.html#af64719f1e001efc3d10e763e5863aac2">$folding</a> = <span class="keyword">true</span>;
<a name="l00144"></a>00144 
<a name="l00150"></a><a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">00150</a>     var <a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>;
<a name="l00151"></a>00151 
<a name="l00157"></a><a class="code" href="class_x_m_l___parser.html#a9285a7f684c72e9bb78fdef1bcbe3fd0">00157</a>     var <a class="code" href="class_x_m_l___parser.html#a9285a7f684c72e9bb78fdef1bcbe3fd0">$handler</a> = array(
<a name="l00158"></a>00158         <span class="stringliteral">&#39;character_data_handler&#39;</span>            =&gt; <span class="stringliteral">&#39;cdataHandler&#39;</span>,
<a name="l00159"></a>00159         <span class="stringliteral">&#39;default_handler&#39;</span>                   =&gt; <span class="stringliteral">&#39;defaultHandler&#39;</span>,
<a name="l00160"></a>00160         <span class="stringliteral">&#39;processing_instruction_handler&#39;</span>    =&gt; <span class="stringliteral">&#39;piHandler&#39;</span>,
<a name="l00161"></a>00161         <span class="stringliteral">&#39;unparsed_entity_decl_handler&#39;</span>      =&gt; <span class="stringliteral">&#39;unparsedHandler&#39;</span>,
<a name="l00162"></a>00162         <span class="stringliteral">&#39;notation_decl_handler&#39;</span>             =&gt; <span class="stringliteral">&#39;notationHandler&#39;</span>,
<a name="l00163"></a>00163         <span class="stringliteral">&#39;external_entity_ref_handler&#39;</span>       =&gt; <span class="stringliteral">&#39;entityrefHandler&#39;</span>
<a name="l00164"></a>00164     );
<a name="l00165"></a>00165 
<a name="l00171"></a><a class="code" href="class_x_m_l___parser.html#a3201cb2edf9eddee10b8d3506396c786">00171</a>     var <a class="code" href="class_x_m_l___parser.html#a3201cb2edf9eddee10b8d3506396c786">$srcenc</a>;
<a name="l00172"></a>00172 
<a name="l00178"></a><a class="code" href="class_x_m_l___parser.html#af2a2bc0bee8dde372a15ea90a347ed8f">00178</a>     var <a class="code" href="class_x_m_l___parser.html#af2a2bc0bee8dde372a15ea90a347ed8f">$tgtenc</a>;
<a name="l00179"></a>00179 
<a name="l00185"></a><a class="code" href="class_x_m_l___parser.html#a6285c6f3d8afe4c5d6b2c4bd792da4b8">00185</a>     var <a class="code" href="class_x_m_l___parser.html#a6285c6f3d8afe4c5d6b2c4bd792da4b8">$_handlerObj</a>;
<a name="l00186"></a>00186 
<a name="l00192"></a><a class="code" href="class_x_m_l___parser.html#a76614e38f8e92bbe09c2a102dd72dfdb">00192</a>     var <a class="code" href="class_x_m_l___parser.html#a76614e38f8e92bbe09c2a102dd72dfdb">$_validEncodings</a> = array(<span class="stringliteral">&#39;ISO-8859-1&#39;</span>, <span class="stringliteral">&#39;UTF-8&#39;</span>, <span class="stringliteral">&#39;US-ASCII&#39;</span>);
<a name="l00193"></a>00193 
<a name="l00194"></a>00194     <span class="comment">// }}}</span>
<a name="l00195"></a>00195     <span class="comment">// {{{ php4 constructor</span>
<a name="l00196"></a>00196 
<a name="l00210"></a><a class="code" href="class_x_m_l___parser.html#a7dd9300d87fed31dd3d15e8fbbcfcd4e">00210</a>     function <a class="code" href="class_x_m_l___parser.html#a7dd9300d87fed31dd3d15e8fbbcfcd4e">XML_Parser</a>(<a class="code" href="class_x_m_l___parser.html#a3201cb2edf9eddee10b8d3506396c786">$srcenc</a> = null, <a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a> = <span class="stringliteral">&#39;event&#39;</span>, <a class="code" href="class_x_m_l___parser.html#af2a2bc0bee8dde372a15ea90a347ed8f">$tgtenc</a> = null)
<a name="l00211"></a>00211     {
<a name="l00212"></a>00212         <a class="code" href="class_x_m_l___parser.html#a299793013d6ec34aaee3e6c83020d568">XML_Parser::__construct</a>(<a class="code" href="class_x_m_l___parser.html#a3201cb2edf9eddee10b8d3506396c786">$srcenc</a>, <a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>, <a class="code" href="class_x_m_l___parser.html#af2a2bc0bee8dde372a15ea90a347ed8f">$tgtenc</a>);
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214     <span class="comment">// }}}</span>
<a name="l00215"></a>00215     <span class="comment">// {{{ php5 constructor</span>
<a name="l00216"></a>00216 
<a name="l00227"></a><a class="code" href="class_x_m_l___parser.html#a299793013d6ec34aaee3e6c83020d568">00227</a>     function <a class="code" href="class_x_m_l___parser.html#a299793013d6ec34aaee3e6c83020d568">__construct</a>(<a class="code" href="class_x_m_l___parser.html#a3201cb2edf9eddee10b8d3506396c786">$srcenc</a> = null, <a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a> = <span class="stringliteral">&#39;event&#39;</span>, <a class="code" href="class_x_m_l___parser.html#af2a2bc0bee8dde372a15ea90a347ed8f">$tgtenc</a> = null)
<a name="l00228"></a>00228     {
<a name="l00229"></a>00229         $this-&gt;<a class="code" href="class_p_e_a_r.html#ab76d2aef23b43b051f5227add98caf98">PEAR</a>(<span class="stringliteral">&#39;XML_Parser_Error&#39;</span>);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         $this-&gt;mode   = <a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>;
<a name="l00232"></a>00232         $this-&gt;srcenc = <a class="code" href="class_x_m_l___parser.html#a3201cb2edf9eddee10b8d3506396c786">$srcenc</a>;
<a name="l00233"></a>00233         $this-&gt;tgtenc = <a class="code" href="class_x_m_l___parser.html#af2a2bc0bee8dde372a15ea90a347ed8f">$tgtenc</a>;
<a name="l00234"></a>00234     }
<a name="l00235"></a>00235     <span class="comment">// }}}</span>
<a name="l00236"></a>00236 
<a name="l00255"></a><a class="code" href="class_x_m_l___parser.html#aedb3b9354b6451554912fd1cb36bb2d0">00255</a>     function <a class="code" href="class_x_m_l___parser.html#aedb3b9354b6451554912fd1cb36bb2d0">setMode</a>(<a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>)
<a name="l00256"></a>00256     {
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (<a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a> != <span class="stringliteral">&#39;func&#39;</span> &amp;&amp; <a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a> != <span class="stringliteral">&#39;event&#39;</span>) {
<a name="l00258"></a>00258             $this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>(<span class="stringliteral">&#39;Unsupported mode given&#39;</span>, 
<a name="l00259"></a>00259                 <a class="code" href="_parser_8php.html#affaa73d6122f2552bf5ff9b49e754cd5">XML_PARSER_ERROR_UNSUPPORTED_MODE</a>);
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261 
<a name="l00262"></a>00262         $this-&gt;mode = <a class="code" href="class_x_m_l___parser.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>;
<a name="l00263"></a>00263         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00264"></a>00264     }
<a name="l00265"></a>00265 
<a name="l00282"></a><a class="code" href="class_x_m_l___parser.html#a59a98e91be1b21ecf76c1ee87f2bdcfa">00282</a>     function <a class="code" href="class_x_m_l___parser.html#a59a98e91be1b21ecf76c1ee87f2bdcfa">setHandlerObj</a>(&amp;$obj)
<a name="l00283"></a>00283     {
<a name="l00284"></a>00284         $this-&gt;_handlerObj = &amp;$obj;
<a name="l00285"></a>00285         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287 
<a name="l00294"></a><a class="code" href="class_x_m_l___parser.html#a1610c4f2e0a3a6f71a5ebb978bbed3b6">00294</a>     function <a class="code" href="class_x_m_l___parser.html#a1610c4f2e0a3a6f71a5ebb978bbed3b6">_initHandlers</a>()
<a name="l00295"></a>00295     {
<a name="l00296"></a>00296         <span class="keywordflow">if</span> (!is_resource($this-&gt;parser)) {
<a name="l00297"></a>00297             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299 
<a name="l00300"></a>00300         <span class="keywordflow">if</span> (!is_object($this-&gt;_handlerObj)) {
<a name="l00301"></a>00301             $this-&gt;_handlerObj = &amp;$this;
<a name="l00302"></a>00302         }
<a name="l00303"></a>00303         <span class="keywordflow">switch</span> ($this-&gt;mode) {
<a name="l00304"></a>00304 
<a name="l00305"></a>00305         <span class="keywordflow">case</span> <span class="stringliteral">&#39;func&#39;</span>:
<a name="l00306"></a>00306             xml_set_object($this-&gt;parser, $this-&gt;_handlerObj);
<a name="l00307"></a>00307             xml_set_element_handler($this-&gt;parser, 
<a name="l00308"></a>00308                 array(&amp;$this, <span class="stringliteral">&#39;funcStartHandler&#39;</span>), array(&amp;$this, <span class="stringliteral">&#39;funcEndHandler&#39;</span>));
<a name="l00309"></a>00309             <span class="keywordflow">break</span>;
<a name="l00310"></a>00310 
<a name="l00311"></a>00311         <span class="keywordflow">case</span> <span class="stringliteral">&#39;event&#39;</span>:
<a name="l00312"></a>00312             xml_set_object($this-&gt;parser, $this-&gt;_handlerObj);
<a name="l00313"></a>00313             xml_set_element_handler($this-&gt;parser, <span class="stringliteral">&#39;startHandler&#39;</span>, <span class="stringliteral">&#39;endHandler&#39;</span>);
<a name="l00314"></a>00314             <span class="keywordflow">break</span>;
<a name="l00315"></a>00315         <span class="keywordflow">default</span>:
<a name="l00316"></a>00316             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>(<span class="stringliteral">&#39;Unsupported mode given&#39;</span>, 
<a name="l00317"></a>00317                 <a class="code" href="_parser_8php.html#affaa73d6122f2552bf5ff9b49e754cd5">XML_PARSER_ERROR_UNSUPPORTED_MODE</a>);
<a name="l00318"></a>00318             <span class="keywordflow">break</span>;
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320 
<a name="l00324"></a>00324         <span class="keywordflow">foreach</span> ($this-&gt;handler as $xml_func =&gt; $method) {
<a name="l00325"></a>00325             <span class="keywordflow">if</span> (method_exists($this-&gt;_handlerObj, $method)) {
<a name="l00326"></a>00326                 $xml_func = <span class="stringliteral">&#39;xml_set_&#39;</span> . $xml_func;
<a name="l00327"></a>00327                 $xml_func($this-&gt;parser, $method);
<a name="l00328"></a>00328             }
<a name="l00329"></a>00329         }
<a name="l00330"></a>00330     }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332     <span class="comment">// {{{ _create()</span>
<a name="l00333"></a>00333 
<a name="l00349"></a><a class="code" href="class_x_m_l___parser.html#a50defc2110196e3caed66d4f61ca4d57">00349</a>     function <a class="code" href="class_x_m_l___parser.html#a50defc2110196e3caed66d4f61ca4d57">_create</a>()
<a name="l00350"></a>00350     {
<a name="l00351"></a>00351         <span class="keywordflow">if</span> ($this-&gt;srcenc === null) {
<a name="l00352"></a>00352             $xp = @xml_parser_create();
<a name="l00353"></a>00353         } <span class="keywordflow">else</span> {
<a name="l00354"></a>00354             $xp = @xml_parser_create($this-&gt;srcenc);
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356         <span class="keywordflow">if</span> (is_resource($xp)) {
<a name="l00357"></a>00357             <span class="keywordflow">if</span> ($this-&gt;tgtenc !== null) {
<a name="l00358"></a>00358                 <span class="keywordflow">if</span> (!@xml_parser_set_option($xp, XML_OPTION_TARGET_ENCODING, 
<a name="l00359"></a>00359                     $this-&gt;tgtenc)
<a name="l00360"></a>00360                 ) {
<a name="l00361"></a>00361                     <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>(<span class="stringliteral">&#39;invalid target encoding&#39;</span>, 
<a name="l00362"></a>00362                         <a class="code" href="_parser_8php.html#a75f314519fa256467bf308404569345a">XML_PARSER_ERROR_INVALID_ENCODING</a>);
<a name="l00363"></a>00363                 }
<a name="l00364"></a>00364             }
<a name="l00365"></a>00365             $this-&gt;parser = $xp;
<a name="l00366"></a>00366             $result       = $this-&gt;<a class="code" href="class_x_m_l___parser.html#a1610c4f2e0a3a6f71a5ebb978bbed3b6">_initHandlers</a>($this-&gt;mode);
<a name="l00367"></a>00367             <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_p_e_a_r.html#a55ae0955466c3970507b122f3f5d1b38">isError</a>($result)) {
<a name="l00368"></a>00368                 <span class="keywordflow">return</span> $result;
<a name="l00369"></a>00369             }
<a name="l00370"></a>00370             xml_parser_set_option($xp, XML_OPTION_CASE_FOLDING, $this-&gt;folding);
<a name="l00371"></a>00371             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00372"></a>00372         }
<a name="l00373"></a>00373         <span class="keywordflow">if</span> (!in_array(strtoupper($this-&gt;srcenc), $this-&gt;_validEncodings)) {
<a name="l00374"></a>00374             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>(<span class="stringliteral">&#39;invalid source encoding&#39;</span>, 
<a name="l00375"></a>00375                 <a class="code" href="_parser_8php.html#a75f314519fa256467bf308404569345a">XML_PARSER_ERROR_INVALID_ENCODING</a>);
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>(<span class="stringliteral">&#39;Unable to create XML parser resource.&#39;</span>, 
<a name="l00378"></a>00378             <a class="code" href="_parser_8php.html#ac41c7c9c4ac68d6f5358c8e1b4966b23">XML_PARSER_ERROR_NO_RESOURCE</a>);
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <span class="comment">// }}}</span>
<a name="l00382"></a>00382     <span class="comment">// {{{ reset()</span>
<a name="l00383"></a>00383 
<a name="l00393"></a><a class="code" href="class_x_m_l___parser.html#a4a20559544fdf4dcb457e258dc976cf8">00393</a>     function <a class="code" href="class_x_m_l___parser.html#a4a20559544fdf4dcb457e258dc976cf8">reset</a>()
<a name="l00394"></a>00394     {
<a name="l00395"></a>00395         $result = $this-&gt;<a class="code" href="class_x_m_l___parser.html#a50defc2110196e3caed66d4f61ca4d57">_create</a>();
<a name="l00396"></a>00396         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_p_e_a_r.html#a55ae0955466c3970507b122f3f5d1b38">isError</a>($result)) {
<a name="l00397"></a>00397             <span class="keywordflow">return</span> $result;
<a name="l00398"></a>00398         }
<a name="l00399"></a>00399         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00400"></a>00400     }
<a name="l00401"></a>00401 
<a name="l00402"></a>00402     <span class="comment">// }}}</span>
<a name="l00403"></a>00403     <span class="comment">// {{{ setInputFile()</span>
<a name="l00404"></a>00404 
<a name="l00415"></a><a class="code" href="class_x_m_l___parser.html#a81147a93817d4df8ab15604017456dbd">00415</a>     function <a class="code" href="class_x_m_l___parser.html#a81147a93817d4df8ab15604017456dbd">setInputFile</a>($file)
<a name="l00416"></a>00416     {
<a name="l00420"></a>00420         <span class="keywordflow">if</span> (eregi(<span class="stringliteral">&#39;^(http|ftp)://&#39;</span>, substr($file, 0, 10))) {
<a name="l00421"></a>00421             <span class="keywordflow">if</span> (!ini_get(<span class="stringliteral">&#39;allow_url_fopen&#39;</span>)) {
<a name="l00422"></a>00422                 <span class="keywordflow">return</span> $this-&gt;
<a name="l00423"></a>00423                 <a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>(<span class="stringliteral">&#39;Remote files cannot be parsed, as safe mode is enabled.&#39;</span>,
<a name="l00424"></a>00424                 <a class="code" href="_parser_8php.html#a885b52cd12814e784e9d4403f0dcf766">XML_PARSER_ERROR_REMOTE</a>);
<a name="l00425"></a>00425             }
<a name="l00426"></a>00426         }
<a name="l00427"></a>00427 
<a name="l00428"></a>00428         <a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a> = @fopen($file, <span class="stringliteral">&#39;rb&#39;</span>);
<a name="l00429"></a>00429         <span class="keywordflow">if</span> (is_resource(<a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>)) {
<a name="l00430"></a>00430             $this-&gt;fp = <a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>;
<a name="l00431"></a>00431             <span class="keywordflow">return</span> <a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>;
<a name="l00432"></a>00432         }
<a name="l00433"></a>00433         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>(<span class="stringliteral">&#39;File could not be opened.&#39;</span>, 
<a name="l00434"></a>00434             <a class="code" href="_parser_8php.html#a488e4bb27a78c6e70c779fa08c47b07d">XML_PARSER_ERROR_FILE_NOT_READABLE</a>);
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437     <span class="comment">// }}}</span>
<a name="l00438"></a>00438     <span class="comment">// {{{ setInputString()</span>
<a name="l00439"></a>00439 
<a name="l00449"></a><a class="code" href="class_x_m_l___parser.html#ae0e53cdd9e868ff4cb9b276e27b27091">00449</a>     function <a class="code" href="class_x_m_l___parser.html#ae0e53cdd9e868ff4cb9b276e27b27091">setInputString</a>($data)
<a name="l00450"></a>00450     {
<a name="l00451"></a>00451         $this-&gt;fp = $data;
<a name="l00452"></a>00452         <span class="keywordflow">return</span> null;
<a name="l00453"></a>00453     }
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="comment">// }}}</span>
<a name="l00456"></a>00456     <span class="comment">// {{{ setInput()</span>
<a name="l00457"></a>00457 
<a name="l00472"></a><a class="code" href="class_x_m_l___parser.html#ad0dd3468beafe96b4fbcd083a8f28a70">00472</a>     function <a class="code" href="class_x_m_l___parser.html#ad0dd3468beafe96b4fbcd083a8f28a70">setInput</a>(<a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>)
<a name="l00473"></a>00473     {
<a name="l00474"></a>00474         <span class="keywordflow">if</span> (is_resource(<a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>)) {
<a name="l00475"></a>00475             $this-&gt;fp = <a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>;
<a name="l00476"></a>00476             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00477"></a>00477         } elseif (eregi(<span class="stringliteral">&#39;^[a-z]+://&#39;</span>, substr(<a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>, 0, 10))) {
<a name="l00478"></a>00478             <span class="comment">// see if it&#39;s an absolute URL (has a scheme at the beginning)</span>
<a name="l00479"></a>00479             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_x_m_l___parser.html#a81147a93817d4df8ab15604017456dbd">setInputFile</a>(<a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>);
<a name="l00480"></a>00480         } elseif (file_exists(<a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>)) {
<a name="l00481"></a>00481             <span class="comment">// see if it&#39;s a local file</span>
<a name="l00482"></a>00482             <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_x_m_l___parser.html#a81147a93817d4df8ab15604017456dbd">setInputFile</a>(<a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>);
<a name="l00483"></a>00483         } <span class="keywordflow">else</span> {
<a name="l00484"></a>00484             <span class="comment">// it must be a string</span>
<a name="l00485"></a>00485             $this-&gt;fp = <a class="code" href="class_x_m_l___parser.html#a1d2c1369c63343a169bc25d1a0475482">$fp</a>;
<a name="l00486"></a>00486             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00487"></a>00487         }
<a name="l00488"></a>00488 
<a name="l00489"></a>00489         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>(<span class="stringliteral">&#39;Illegal input format&#39;</span>, 
<a name="l00490"></a>00490             <a class="code" href="_parser_8php.html#ab00af2c85bf62831ad87061b19012268">XML_PARSER_ERROR_INVALID_INPUT</a>);
<a name="l00491"></a>00491     }
<a name="l00492"></a>00492 
<a name="l00493"></a>00493     <span class="comment">// }}}</span>
<a name="l00494"></a>00494     <span class="comment">// {{{ parse()</span>
<a name="l00495"></a>00495 
<a name="l00502"></a><a class="code" href="class_x_m_l___parser.html#a38d99acc70a1d8fd8f94455743b2d237">00502</a>     function <a class="code" href="class_x_m_l___parser.html#a38d99acc70a1d8fd8f94455743b2d237">parse</a>()
<a name="l00503"></a>00503     {
<a name="l00507"></a>00507         $result = $this-&gt;<a class="code" href="class_x_m_l___parser.html#a4a20559544fdf4dcb457e258dc976cf8">reset</a>();
<a name="l00508"></a>00508         <span class="keywordflow">if</span> ($this-&gt;<a class="code" href="class_p_e_a_r.html#a55ae0955466c3970507b122f3f5d1b38">isError</a>($result)) {
<a name="l00509"></a>00509             <span class="keywordflow">return</span> $result;
<a name="l00510"></a>00510         }
<a name="l00511"></a>00511         <span class="comment">// if $this-&gt;fp was fopened previously</span>
<a name="l00512"></a>00512         <span class="keywordflow">if</span> (is_resource($this-&gt;fp)) {
<a name="l00513"></a>00513 
<a name="l00514"></a>00514             <span class="keywordflow">while</span> ($data = fread($this-&gt;fp, 4096)) {
<a name="l00515"></a>00515                 <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_x_m_l___parser.html#a6e423e915df1f17ff6cbe4d46428d6d3">_parseString</a>($data, feof($this-&gt;fp))) {
<a name="l00516"></a>00516                     $error = &amp;$this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>();
<a name="l00517"></a>00517                     $this-&gt;<a class="code" href="class_x_m_l___parser.html#a5ad8044ee4b8a2c8bdb8b5c3dc786424">free</a>();
<a name="l00518"></a>00518                     <span class="keywordflow">return</span> $error;
<a name="l00519"></a>00519                 }
<a name="l00520"></a>00520             }
<a name="l00521"></a>00521         } <span class="keywordflow">else</span> {
<a name="l00522"></a>00522             <span class="comment">// otherwise, $this-&gt;fp must be a string</span>
<a name="l00523"></a>00523             <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_x_m_l___parser.html#a6e423e915df1f17ff6cbe4d46428d6d3">_parseString</a>($this-&gt;fp, <span class="keyword">true</span>)) {
<a name="l00524"></a>00524                 $error = &amp;$this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>();
<a name="l00525"></a>00525                 $this-&gt;<a class="code" href="class_x_m_l___parser.html#a5ad8044ee4b8a2c8bdb8b5c3dc786424">free</a>();
<a name="l00526"></a>00526                 <span class="keywordflow">return</span> $error;
<a name="l00527"></a>00527             }
<a name="l00528"></a>00528         }
<a name="l00529"></a>00529         $this-&gt;<a class="code" href="class_x_m_l___parser.html#a5ad8044ee4b8a2c8bdb8b5c3dc786424">free</a>();
<a name="l00530"></a>00530 
<a name="l00531"></a>00531         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533 
<a name="l00544"></a><a class="code" href="class_x_m_l___parser.html#a6e423e915df1f17ff6cbe4d46428d6d3">00544</a>     function <a class="code" href="class_x_m_l___parser.html#a6e423e915df1f17ff6cbe4d46428d6d3">_parseString</a>($data, $eof = <span class="keyword">false</span>)
<a name="l00545"></a>00545     {
<a name="l00546"></a>00546         <span class="keywordflow">return</span> xml_parse($this-&gt;parser, $data, $eof);
<a name="l00547"></a>00547     }
<a name="l00548"></a>00548 
<a name="l00549"></a>00549     <span class="comment">// }}}</span>
<a name="l00550"></a>00550     <span class="comment">// {{{ parseString()</span>
<a name="l00551"></a>00551 
<a name="l00565"></a><a class="code" href="class_x_m_l___parser.html#a49c843ccf8f50933c7373d638e8ea347">00565</a>     function <a class="code" href="class_x_m_l___parser.html#a49c843ccf8f50933c7373d638e8ea347">parseString</a>($data, $eof = <span class="keyword">false</span>)
<a name="l00566"></a>00566     {
<a name="l00567"></a>00567         <span class="keywordflow">if</span> (!isset($this-&gt;parser) || !is_resource($this-&gt;parser)) {
<a name="l00568"></a>00568             $this-&gt;<a class="code" href="class_x_m_l___parser.html#a4a20559544fdf4dcb457e258dc976cf8">reset</a>();
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571         <span class="keywordflow">if</span> (!$this-&gt;<a class="code" href="class_x_m_l___parser.html#a6e423e915df1f17ff6cbe4d46428d6d3">_parseString</a>($data, $eof)) {
<a name="l00572"></a>00572             $error = &amp;$this-&gt;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>();
<a name="l00573"></a>00573             $this-&gt;<a class="code" href="class_x_m_l___parser.html#a5ad8044ee4b8a2c8bdb8b5c3dc786424">free</a>();
<a name="l00574"></a>00574             <span class="keywordflow">return</span> $error;
<a name="l00575"></a>00575         }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         <span class="keywordflow">if</span> ($eof === <span class="keyword">true</span>) {
<a name="l00578"></a>00578             $this-&gt;<a class="code" href="class_x_m_l___parser.html#a5ad8044ee4b8a2c8bdb8b5c3dc786424">free</a>();
<a name="l00579"></a>00579         }
<a name="l00580"></a>00580         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00581"></a>00581     }
<a name="l00582"></a>00582 
<a name="l00590"></a><a class="code" href="class_x_m_l___parser.html#a5ad8044ee4b8a2c8bdb8b5c3dc786424">00590</a>     function <a class="code" href="class_x_m_l___parser.html#a5ad8044ee4b8a2c8bdb8b5c3dc786424">free</a>()
<a name="l00591"></a>00591     {
<a name="l00592"></a>00592         <span class="keywordflow">if</span> (isset($this-&gt;parser) &amp;&amp; is_resource($this-&gt;parser)) {
<a name="l00593"></a>00593             xml_parser_free($this-&gt;parser);
<a name="l00594"></a>00594             unset( $this-&gt;parser );
<a name="l00595"></a>00595         }
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (isset($this-&gt;fp) &amp;&amp; is_resource($this-&gt;fp)) {
<a name="l00597"></a>00597             fclose($this-&gt;fp);
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599         unset($this-&gt;fp);
<a name="l00600"></a>00600         <span class="keywordflow">return</span> null;
<a name="l00601"></a>00601     }
<a name="l00602"></a>00602 
<a name="l00613"></a><a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">00613</a>     function &amp;<a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">raiseError</a>($msg = null, $ecode = 0)
<a name="l00614"></a>00614     {
<a name="l00615"></a>00615         $msg = !is_null($msg) ? $msg : $this-&gt;parser;
<a name="l00616"></a>00616         $err = &amp;<span class="keyword">new</span> <a class="code" href="class_x_m_l___parser___error.html">XML_Parser_Error</a>($msg, $ecode);
<a name="l00617"></a>00617         <span class="keywordflow">return</span> <a class="code" href="class_x_m_l___parser.html#acabbf2997f0c06dfdb502aef3008c3e9">parent::raiseError</a>($err);
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620     <span class="comment">// }}}</span>
<a name="l00621"></a>00621     <span class="comment">// {{{ funcStartHandler()</span>
<a name="l00622"></a>00622 
<a name="l00632"></a><a class="code" href="class_x_m_l___parser.html#a720aa56b558e1ed30a56076abda8127a">00632</a>     function <a class="code" href="class_x_m_l___parser.html#a720aa56b558e1ed30a56076abda8127a">funcStartHandler</a>($xp, $elem, $attribs)
<a name="l00633"></a>00633     {
<a name="l00634"></a>00634         $func = <span class="stringliteral">&#39;xmltag_&#39;</span> . $elem;
<a name="l00635"></a>00635         $func = str_replace(array(<span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;:&#39;</span>), <span class="charliteral">&#39;_&#39;</span>, $func);
<a name="l00636"></a>00636         <span class="keywordflow">if</span> (method_exists($this-&gt;_handlerObj, $func)) {
<a name="l00637"></a>00637             call_user_func(array(&amp;$this-&gt;_handlerObj, $func), $xp, $elem, $attribs);
<a name="l00638"></a>00638         } elseif (method_exists($this-&gt;_handlerObj, <span class="stringliteral">&#39;xmltag&#39;</span>)) {
<a name="l00639"></a>00639             call_user_func(array(&amp;$this-&gt;_handlerObj, <span class="stringliteral">&#39;xmltag&#39;</span>), 
<a name="l00640"></a>00640                 $xp, $elem, $attribs);
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642     }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <span class="comment">// }}}</span>
<a name="l00645"></a>00645     <span class="comment">// {{{ funcEndHandler()</span>
<a name="l00646"></a>00646 
<a name="l00655"></a><a class="code" href="class_x_m_l___parser.html#a9e0e1d0b32068ba416f2a77ad2c0a18c">00655</a>     function <a class="code" href="class_x_m_l___parser.html#a9e0e1d0b32068ba416f2a77ad2c0a18c">funcEndHandler</a>($xp, $elem)
<a name="l00656"></a>00656     {
<a name="l00657"></a>00657         $func = <span class="stringliteral">&#39;xmltag_&#39;</span> . $elem . <span class="charliteral">&#39;_&#39;</span>;
<a name="l00658"></a>00658         $func = str_replace(array(<span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;-&#39;</span>, <span class="charliteral">&#39;:&#39;</span>), <span class="charliteral">&#39;_&#39;</span>, $func);
<a name="l00659"></a>00659         <span class="keywordflow">if</span> (method_exists($this-&gt;_handlerObj, $func)) {
<a name="l00660"></a>00660             call_user_func(array(&amp;$this-&gt;_handlerObj, $func), $xp, $elem);
<a name="l00661"></a>00661         } elseif (method_exists($this-&gt;_handlerObj, <span class="stringliteral">&#39;xmltag_&#39;</span>)) {
<a name="l00662"></a>00662             call_user_func(array(&amp;$this-&gt;_handlerObj, <span class="stringliteral">&#39;xmltag_&#39;</span>), $xp, $elem);
<a name="l00663"></a>00663         }
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666     <span class="comment">// }}}</span>
<a name="l00667"></a>00667     <span class="comment">// {{{ startHandler()</span>
<a name="l00668"></a>00668 
<a name="l00679"></a><a class="code" href="class_x_m_l___parser.html#ada1ff98b81b1bd9ec232449c49318d1e">00679</a>     function <a class="code" href="class_x_m_l___parser.html#ada1ff98b81b1bd9ec232449c49318d1e">startHandler</a>($xp, $elem, &amp;$attribs)
<a name="l00680"></a>00680     {
<a name="l00681"></a>00681         <span class="keywordflow">return</span> null;
<a name="l00682"></a>00682     }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684     <span class="comment">// }}}</span>
<a name="l00685"></a>00685     <span class="comment">// {{{ endHandler()</span>
<a name="l00686"></a>00686 
<a name="l00696"></a><a class="code" href="class_x_m_l___parser.html#aedb3771506ffc5b3138a0bdea7d13df6">00696</a>     function <a class="code" href="class_x_m_l___parser.html#aedb3771506ffc5b3138a0bdea7d13df6">endHandler</a>($xp, $elem)
<a name="l00697"></a>00697     {
<a name="l00698"></a>00698         <span class="keywordflow">return</span> null;
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700 
<a name="l00701"></a>00701 
<a name="l00702"></a>00702     <span class="comment">// }}}me</span>
<a name="l00703"></a>00703 }
<a name="l00704"></a>00704 
<a name="l00727"></a><a class="code" href="class_x_m_l___parser___error.html">00727</a> <span class="keyword">class </span><a class="code" href="class_x_m_l___parser___error.html">XML_Parser_Error</a> <span class="keyword">extends</span> <a class="code" href="class_p_e_a_r___error.html">PEAR_Error</a>
<a name="l00728"></a>00728 {
<a name="l00729"></a>00729     <span class="comment">// {{{ properties</span>
<a name="l00730"></a>00730 
<a name="l00736"></a><a class="code" href="class_x_m_l___parser___error.html#a8b5856f5d559a15bdd55e9021d6cb6e0">00736</a>     var <a class="code" href="class_x_m_l___parser___error.html#a8b5856f5d559a15bdd55e9021d6cb6e0">$error_message_prefix</a> = <span class="stringliteral">&#39;XML_Parser: &#39;</span>;
<a name="l00737"></a>00737 
<a name="l00738"></a>00738     <span class="comment">// }}}</span>
<a name="l00739"></a>00739     <span class="comment">// {{{ constructor()</span>
<a name="l00755"></a><a class="code" href="class_x_m_l___parser___error.html#a33c15e089c08637b95e068aa7fc041ad">00755</a> <span class="comment"></span>    function <a class="code" href="class_x_m_l___parser___error.html#a33c15e089c08637b95e068aa7fc041ad">XML_Parser_Error</a>($msgorparser = <span class="stringliteral">&#39;unknown error&#39;</span>, <a class="code" href="class_p_e_a_r___error.html#a7949acdaecc70b9f035c12a7069db132">$code</a> = 0, <a class="code" href="class_p_e_a_r___error.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a> = <a class="code" href="_p_e_a_r_8php.html#acfe1d5846207d81d3b2882fabbd56840">PEAR_ERROR_RETURN</a>, <a class="code" href="class_p_e_a_r___error.html#abd32cc82c6a3f79491987de36ad580ca">$level</a> = E_USER_NOTICE)
<a name="l00756"></a>00756     {
<a name="l00757"></a>00757         <span class="keywordflow">if</span> (is_resource($msgorparser)) {
<a name="l00758"></a>00758             <a class="code" href="class_p_e_a_r___error.html#a7949acdaecc70b9f035c12a7069db132">$code</a>        = xml_get_error_code($msgorparser);
<a name="l00759"></a>00759             $msgorparser = sprintf(<span class="stringliteral">&#39;%s at XML input line %d:%d&#39;</span>,
<a name="l00760"></a>00760                 xml_error_string(<a class="code" href="class_p_e_a_r___error.html#a7949acdaecc70b9f035c12a7069db132">$code</a>),
<a name="l00761"></a>00761                 xml_get_current_line_number($msgorparser),
<a name="l00762"></a>00762                 xml_get_current_column_number($msgorparser));
<a name="l00763"></a>00763         }
<a name="l00764"></a>00764         $this-&gt;<a class="code" href="class_p_e_a_r___error.html#a5319a4e116f32f766325aa5ade5f6014">PEAR_Error</a>($msgorparser, <a class="code" href="class_p_e_a_r___error.html#a7949acdaecc70b9f035c12a7069db132">$code</a>, <a class="code" href="class_p_e_a_r___error.html#a3aaf40baac36e278c7d7c9139df1750c">$mode</a>, <a class="code" href="class_p_e_a_r___error.html#abd32cc82c6a3f79491987de36ad580ca">$level</a>);
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766     <span class="comment">// }}}</span>
<a name="l00767"></a>00767 }
<a name="l00768"></a>00768 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Wed Jul 7 2010 15:06:49 for zimbraControl by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
